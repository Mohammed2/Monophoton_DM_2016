#include <fstream>
#include <vector>
#include <iomanip>
#include "TFile.h"
#include "TH2.h"
#include "TH2F.h"
#include "TGraph2D.h"
#include "TStyle.h"
#include "TCanvas.h"
#include "TMath.h"
#include "TString.h"
#include "THStack.h"
#include "TPaveText.h"
#include "TLegend.h"
#include "TColor.h"
#include "TGraphErrors.h"

// xaxis_variable must be one of "Pt", "MET", or "Mt"
void collate_transfer_histos_singlevariable(string xaxis_variable)
{
  //DEBUG
  // cout<<"Entering"<<endl;
  
  int nBins_temp = -1;
  string histname_signalRegion = "HISTAME_SIGNALREGION_NOT_SET";
  string histname_nonSignalRegion = "HISTNAME_NONSIGNALREGION_NOT_SET";
  string fileprefix_pdfscale = "FILEPREFIX_PDFSCALE_NOT_SET";
  TString xaxis_title_signalRegion = TString("XAXIS_TITLE_SIGNALREGION_NOT_SET");
  TString xaxis_title_nonSignalRegion = TString("XAXIS_TITLE_NONSIGNALREGION_NOT_SET");
  string saveAs_suffix = "SAVEAS_SUFFIX_NOT_SET";
  if(xaxis_variable == "Pt"){
    nBins_temp = 6;
    histname_signalRegion = "Photon_Et_range";
    histname_nonSignalRegion = "Photon_Et_range";
    fileprefix_pdfscale = "histos_Pt";
    xaxis_title_signalRegion = TString("E_{T}^{#gamma} [GeV]");
    xaxis_title_nonSignalRegion = TString("E_{T}^{#gamma} [GeV]");
    saveAs_suffix = "phoPt";
  }
  else if(xaxis_variable == "MET"){
    nBins_temp = 6;
    histname_signalRegion = "pfMET";
    histname_nonSignalRegion = "h_photonic_recoil";
    fileprefix_pdfscale = "histos_MET";
    xaxis_title_signalRegion = TString("pfMET [GeV]");
    xaxis_title_nonSignalRegion = TString("Photonic Recoil [GeV]");
    saveAs_suffix = "MET";
  }
  else if(xaxis_variable == "Mt"){
    nBins_temp = 9;
    histname_signalRegion = "Mt";
    histname_nonSignalRegion = "h_phoRecoilMt";
    fileprefix_pdfscale = "histos_Mt";
    xaxis_title_signalRegion = TString("Photon-MET #it{M}_{T} [GeV]");
    xaxis_title_nonSignalRegion = TString("Photon-MET #it{M}_{T} [GeV]");
    saveAs_suffix = "Mt";
  }
  const int nBins = nBins_temp;
    
  double scale_unc_electron = 0.02;
  double scale_unc_muon = 0.01;
  double scale_unc_electron_squared = 0.04;
  double scale_unc_muon_squared = 0.02;
  
  // DEBUG
  // cout<<"Preliminaries set up"<<endl;
  
  //////////////////////////////////
  // Open all the necessary files //
  //////////////////////////////////
  
  TFile* f_ZnnG_WGJets = new TFile("ZnnG_JESPES_WGJets.root");
  TFile* f_ZnnG_WGJets_ext = new TFile("ZnnG_JESPES_WGJets_ext.root");
  TFile* f_ZnnG_WGJets_mitExt = new TFile("ZnnG_JESPES_WGJets_mitExt.root");
  TFile* f_ZnnG_ZNuNuGJets = new TFile("ZnnG_JESPES_ZNuNuGJets.root");
  TFile* f_ZnnG_ZNuNuGJets_ext = new TFile("ZnnG_JESPES_ZNuNuGJets_ext.root");
  TFile* f_WmnG_WGJets = new TFile("WmnG_JESPES_WGJets.root");
  TFile* f_WenG_WGJets = new TFile("WenG_JESPES_WGJets.root");
  TFile* f_WmnG_WGJets_ext = new TFile("WmnG_JESPES_WGJets_ext.root");
  TFile* f_WenG_WGJets_ext = new TFile("WenG_JESPES_WGJets_ext.root");
  TFile* f_WmnG_WGJets_mitExt = new TFile("WmnG_JESPES_WGJets_mitExt.root");
  TFile* f_WenG_WGJets_mitExt = new TFile("WenG_JESPES_WGJets_mitExt.root");
  TFile* f_ZeeG_ZLLGJets_130_under300 = new TFile("ZeeG_JESPES_ZLLGJets_130_under300.root");
  TFile* f_ZmmG_ZLLGJets_130_under300 = new TFile("ZmmG_JESPES_ZLLGJets_130_under300.root");
  TFile* f_ZeeG_ZLLGJets_300 = new TFile("ZeeG_JESPES_ZLLGJets_300.root");
  TFile* f_ZmmG_ZLLGJets_300 = new TFile("ZmmG_JESPES_ZLLGJets_300.root");
  TFile* f_ZnnG_ZNuNuGJets_pdfscale = new TFile(TString(fileprefix_pdfscale+"_ZnnG_pdfscale_ZNuNuGJets.root"));
  TFile* f_ZnnG_ZNuNuGJets_ext_pdfscale = new TFile(TString(fileprefix_pdfscale+"_ZnnG_pdfscale_ZNuNuGJets_ext.root"));
  TFile* f_ZnnG_WGJets_pdfscale = new TFile(TString(fileprefix_pdfscale+"_ZnnG_pdfscale_WGJets.root"));
  TFile* f_WenG_WGJets_pdfscale = new TFile(TString(fileprefix_pdfscale+"_WenG_pdfscale_WGJets.root"));
  TFile* f_WmnG_WGJets_pdfscale = new TFile(TString(fileprefix_pdfscale+"_WmnG_pdfscale_WGJets.root"));
  TFile* f_ZnnG_WGJets_ext_pdfscale = new TFile(TString(fileprefix_pdfscale+"_ZnnG_pdfscale_WGJets_ext.root"));
  TFile* f_WenG_WGJets_ext_pdfscale = new TFile(TString(fileprefix_pdfscale+"_WenG_pdfscale_WGJets_ext.root"));
  TFile* f_WmnG_WGJets_ext_pdfscale = new TFile(TString(fileprefix_pdfscale+"_WmnG_pdfscale_WGJets_ext.root"));
  TFile* f_ZnnG_WGJets_mitExt_pdfscale = new TFile(TString(fileprefix_pdfscale+"_ZnnG_pdfscale_WGJets_mitExt.root"));
  TFile* f_WenG_WGJets_mitExt_pdfscale = new TFile(TString(fileprefix_pdfscale+"_WenG_pdfscale_WGJets_mitExt.root"));
  TFile* f_WmnG_WGJets_mitExt_pdfscale = new TFile(TString(fileprefix_pdfscale+"_WmnG_pdfscale_WGJets_mitExt.root"));
  // DEBUG
  // cout<<"Files got"<<endl;
  
  ///////////////////////////////////
  // Grab all the necessary histos //
  ///////////////////////////////////
  
  // Unscaled WGJets, ZNuNuGJets; all regions
  TH1F* histo_WenG_WGJets_unscaled = (TH1F*)f_WenG_WGJets->Get(TString(histname_nonSignalRegion+"_5"));
  histo_WenG_WGJets_unscaled->SetBinContent(nBins, histo_WenG_WGJets_unscaled->GetBinContent(nBins)+histo_WenG_WGJets_unscaled->GetBinContent(nBins+1));
  histo_WenG_WGJets_unscaled->ClearUnderflowAndOverflow();
  TH1F* histo_WmnG_WGJets_unscaled = (TH1F*)f_WmnG_WGJets->Get(TString(histname_nonSignalRegion+"_4"));
  histo_WmnG_WGJets_unscaled->SetBinContent(nBins, histo_WmnG_WGJets_unscaled->GetBinContent(nBins)+histo_WmnG_WGJets_unscaled->GetBinContent(nBins+1));
  histo_WmnG_WGJets_unscaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_WGJets_unscaled = (TH1F*)f_ZnnG_WGJets->Get(TString(histname_signalRegion+"_24"));
  histo_ZnnG_WGJets_unscaled->SetBinContent(nBins, histo_ZnnG_WGJets_unscaled->GetBinContent(nBins)+histo_ZnnG_WGJets_unscaled->GetBinContent(nBins+1));
  histo_ZnnG_WGJets_unscaled->ClearUnderflowAndOverflow();
  TH1F* histo_WenG_WGJets_ext_unscaled = (TH1F*)f_WenG_WGJets_ext->Get(TString(histname_nonSignalRegion+"_5"));
  histo_WenG_WGJets_ext_unscaled->SetBinContent(nBins, histo_WenG_WGJets_ext_unscaled->GetBinContent(nBins)+histo_WenG_WGJets_ext_unscaled->GetBinContent(nBins+1));
  histo_WenG_WGJets_ext_unscaled->ClearUnderflowAndOverflow();
  TH1F* histo_WmnG_WGJets_ext_unscaled = (TH1F*)f_WmnG_WGJets_ext->Get(TString(histname_nonSignalRegion+"_4"));
  histo_WmnG_WGJets_ext_unscaled->SetBinContent(nBins, histo_WmnG_WGJets_ext_unscaled->GetBinContent(nBins)+histo_WmnG_WGJets_ext_unscaled->GetBinContent(nBins+1));
  histo_WmnG_WGJets_ext_unscaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_WGJets_ext_unscaled = (TH1F*)f_ZnnG_WGJets_ext->Get(TString(histname_signalRegion+"_24"));
  histo_ZnnG_WGJets_ext_unscaled->SetBinContent(nBins, histo_ZnnG_WGJets_ext_unscaled->GetBinContent(nBins)+histo_ZnnG_WGJets_ext_unscaled->GetBinContent(nBins+1));
  histo_ZnnG_WGJets_ext_unscaled->ClearUnderflowAndOverflow();
  TH1F* histo_WenG_WGJets_mitExt_unscaled = (TH1F*)f_WenG_WGJets_mitExt->Get(TString(histname_nonSignalRegion+"_5"));
  histo_WenG_WGJets_mitExt_unscaled->SetBinContent(nBins, histo_WenG_WGJets_mitExt_unscaled->GetBinContent(nBins)+histo_WenG_WGJets_mitExt_unscaled->GetBinContent(nBins+1));
  histo_WenG_WGJets_mitExt_unscaled->ClearUnderflowAndOverflow();
  TH1F* histo_WmnG_WGJets_mitExt_unscaled = (TH1F*)f_WmnG_WGJets_mitExt->Get(TString(histname_nonSignalRegion+"_4"));
  histo_WmnG_WGJets_mitExt_unscaled->SetBinContent(nBins, histo_WmnG_WGJets_mitExt_unscaled->GetBinContent(nBins)+histo_WmnG_WGJets_mitExt_unscaled->GetBinContent(nBins+1));
  histo_WmnG_WGJets_mitExt_unscaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_WGJets_mitExt_unscaled = (TH1F*)f_ZnnG_WGJets_mitExt->Get(TString(histname_signalRegion+"_24"));
  histo_ZnnG_WGJets_mitExt_unscaled->SetBinContent(nBins, histo_ZnnG_WGJets_mitExt_unscaled->GetBinContent(nBins)+histo_ZnnG_WGJets_mitExt_unscaled->GetBinContent(nBins+1));
  histo_ZnnG_WGJets_mitExt_unscaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_ZNuNuGJets_unscaled = (TH1F*)f_ZnnG_ZNuNuGJets->Get(TString(histname_signalRegion+"_24"));
  histo_ZnnG_ZNuNuGJets_unscaled->SetBinContent(nBins, histo_ZnnG_ZNuNuGJets_unscaled->GetBinContent(nBins)+histo_ZnnG_ZNuNuGJets_unscaled->GetBinContent(nBins+1));
  histo_ZnnG_ZNuNuGJets_unscaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_ZNuNuGJets_ext_unscaled = (TH1F*)f_ZnnG_ZNuNuGJets_ext->Get(TString(histname_signalRegion+"_24"));
  histo_ZnnG_ZNuNuGJets_ext_unscaled->SetBinContent(nBins, histo_ZnnG_ZNuNuGJets_ext_unscaled->GetBinContent(nBins)+histo_ZnnG_ZNuNuGJets_ext_unscaled->GetBinContent(nBins+1));
  histo_ZnnG_ZNuNuGJets_ext_unscaled->ClearUnderflowAndOverflow();
  histo_WenG_WGJets_unscaled->Add(histo_WenG_WGJets_ext_unscaled);
  histo_WmnG_WGJets_unscaled->Add(histo_WmnG_WGJets_ext_unscaled);
  histo_ZnnG_WGJets_unscaled->Add(histo_ZnnG_WGJets_ext_unscaled);
  histo_WenG_WGJets_unscaled->Add(histo_WenG_WGJets_mitExt_unscaled);
  histo_WmnG_WGJets_unscaled->Add(histo_WmnG_WGJets_mitExt_unscaled);
  histo_ZnnG_WGJets_unscaled->Add(histo_ZnnG_WGJets_mitExt_unscaled);
  histo_ZnnG_ZNuNuGJets_unscaled->Add(histo_ZnnG_ZNuNuGJets_ext_unscaled);
  // Scaled WGJets, ZNuNuGJets, ZLLGJets_130_under300, ZLLGJets_300; all regions
  TH1F* histo_ZnnG_WGJets_scaled = (TH1F*)histo_ZnnG_WGJets_unscaled->Clone("histo_ZnnG_WGJets_scaled");
  histo_ZnnG_WGJets_scaled->Scale(0.65521/30469887.0);
  TH1F* histo_WenG_WGJets_scaled = (TH1F*)histo_WenG_WGJets_unscaled->Clone("histo_WenG_WGJets_scaled");
  histo_WenG_WGJets_scaled->Scale(0.65521/30469887.0);
  TH1F* histo_WmnG_WGJets_scaled = (TH1F*)histo_WmnG_WGJets_unscaled->Clone("histo_WmnG_WGJets_scaled");
  histo_WmnG_WGJets_scaled->Scale(0.65521/30469887.0);
  TH1F* histo_ZnnG_ZNuNuGJets_scaled = (TH1F*)histo_ZnnG_ZNuNuGJets_unscaled->Clone("histo_ZnnG_ZNuNuGJets_scaled");
  histo_ZnnG_ZNuNuGJets_scaled->Scale(0.18213/2040365.0);
  TH1F* histo_ZeeG_ZLLGJets_130_under300_scaled = (TH1F*)f_ZeeG_ZLLGJets_130_under300->Get(TString(histname_nonSignalRegion+"_4"));
  histo_ZeeG_ZLLGJets_130_under300_scaled->SetBinContent(nBins, histo_ZeeG_ZLLGJets_130_under300_scaled->GetBinContent(nBins)+histo_ZeeG_ZLLGJets_130_under300_scaled->GetBinContent(nBins+1));
  histo_ZeeG_ZLLGJets_130_under300_scaled->ClearUnderflowAndOverflow();
  histo_ZeeG_ZLLGJets_130_under300_scaled->Scale(0.148/489423.0);
  TH1F* histo_ZmmG_ZLLGJets_130_under300_scaled = (TH1F*)f_ZmmG_ZLLGJets_130_under300->Get(TString(histname_nonSignalRegion+"_4"));
  histo_ZmmG_ZLLGJets_130_under300_scaled->SetBinContent(nBins, histo_ZmmG_ZLLGJets_130_under300_scaled->GetBinContent(nBins)+histo_ZmmG_ZLLGJets_130_under300_scaled->GetBinContent(nBins+1));
  histo_ZmmG_ZLLGJets_130_under300_scaled->ClearUnderflowAndOverflow();
  histo_ZmmG_ZLLGJets_130_under300_scaled->Scale(0.148/489423.0);
  TH1F* histo_ZeeG_ZLLGJets_300_scaled = (TH1F*)f_ZeeG_ZLLGJets_300->Get(TString(histname_nonSignalRegion+"_4"));
  histo_ZeeG_ZLLGJets_300_scaled->SetBinContent(nBins, histo_ZeeG_ZLLGJets_300_scaled->GetBinContent(nBins)+histo_ZeeG_ZLLGJets_300_scaled->GetBinContent(nBins+1));
  histo_ZeeG_ZLLGJets_300_scaled->ClearUnderflowAndOverflow();
  histo_ZeeG_ZLLGJets_300_scaled->Scale(0.0092/1707773.0);
  TH1F* histo_ZmmG_ZLLGJets_300_scaled = (TH1F*)f_ZmmG_ZLLGJets_300->Get(TString(histname_nonSignalRegion+"_4"));
  histo_ZmmG_ZLLGJets_300_scaled->SetBinContent(nBins, histo_ZmmG_ZLLGJets_300_scaled->GetBinContent(nBins)+histo_ZmmG_ZLLGJets_300_scaled->GetBinContent(nBins+1));
  histo_ZmmG_ZLLGJets_300_scaled->ClearUnderflowAndOverflow();
  histo_ZmmG_ZLLGJets_300_scaled->Scale(0.0092/1707773.0);
  // DEBUG
  // cout<<"First scaling block done"<<endl;
  
  // Scaled WGJets variations, ZnnG region
  TH1F* histo_ZnnG_WGJets_ewkscaleUp_scaled = (TH1F*)f_ZnnG_WGJets->Get(TString(histname_signalRegion+"_21"));
  histo_ZnnG_WGJets_ewkscaleUp_scaled->SetBinContent(nBins, histo_ZnnG_WGJets_ewkscaleUp_scaled->GetBinContent(nBins)+histo_ZnnG_WGJets_ewkscaleUp_scaled->GetBinContent(nBins+1));
  histo_ZnnG_WGJets_ewkscaleUp_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_WGJets_ewkscaleDown_scaled = (TH1F*)f_ZnnG_WGJets->Get(TString(histname_signalRegion+"_22"));
  histo_ZnnG_WGJets_ewkscaleDown_scaled->SetBinContent(nBins, histo_ZnnG_WGJets_ewkscaleDown_scaled->GetBinContent(nBins)+histo_ZnnG_WGJets_ewkscaleDown_scaled->GetBinContent(nBins+1));
  histo_ZnnG_WGJets_ewkscaleDown_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_WGJets_ewkshapeUp_scaled = (TH1F*)f_ZnnG_WGJets->Get(TString(histname_signalRegion+"_31"));
  histo_ZnnG_WGJets_ewkshapeUp_scaled->SetBinContent(nBins, histo_ZnnG_WGJets_ewkshapeUp_scaled->GetBinContent(nBins)+histo_ZnnG_WGJets_ewkshapeUp_scaled->GetBinContent(nBins+1));
  histo_ZnnG_WGJets_ewkshapeUp_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_WGJets_ewkshapeDown_scaled = (TH1F*)f_ZnnG_WGJets->Get(TString(histname_signalRegion+"_32"));
  histo_ZnnG_WGJets_ewkshapeDown_scaled->SetBinContent(nBins, histo_ZnnG_WGJets_ewkshapeDown_scaled->GetBinContent(nBins)+histo_ZnnG_WGJets_ewkshapeDown_scaled->GetBinContent(nBins+1));
  histo_ZnnG_WGJets_ewkshapeDown_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_WGJets_gammaUp_scaled = (TH1F*)f_ZnnG_WGJets->Get(TString(histname_signalRegion+"_33"));
  histo_ZnnG_WGJets_gammaUp_scaled->SetBinContent(nBins, histo_ZnnG_WGJets_gammaUp_scaled->GetBinContent(nBins)+histo_ZnnG_WGJets_gammaUp_scaled->GetBinContent(nBins+1));
  histo_ZnnG_WGJets_gammaUp_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_WGJets_gammaDown_scaled = (TH1F*)f_ZnnG_WGJets->Get(TString(histname_signalRegion+"_34"));
  histo_ZnnG_WGJets_gammaDown_scaled->SetBinContent(nBins, histo_ZnnG_WGJets_gammaDown_scaled->GetBinContent(nBins)+histo_ZnnG_WGJets_gammaDown_scaled->GetBinContent(nBins+1));
  histo_ZnnG_WGJets_gammaDown_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_WGJets_pdfUp_scaled = (TH1F*)f_ZnnG_WGJets_pdfscale->Get("h_ZnnG_pdfscale_WGJets_pdfUp_unscaled");
  TH1F* histo_ZnnG_WGJets_pdfDown_scaled = (TH1F*)f_ZnnG_WGJets_pdfscale->Get("h_ZnnG_pdfscale_WGJets_pdfDown_unscaled");
  TH1F* histo_ZnnG_WGJets_qcdscale_scaled = (TH1F*)f_ZnnG_WGJets->Get(TString(histname_signalRegion+"_23"));
  histo_ZnnG_WGJets_qcdscale_scaled->SetBinContent(nBins, histo_ZnnG_WGJets_qcdscale_scaled->GetBinContent(nBins)+histo_ZnnG_WGJets_qcdscale_scaled->GetBinContent(nBins+1));
  histo_ZnnG_WGJets_qcdscale_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_WGJets_ext_ewkscaleUp_scaled = (TH1F*)f_ZnnG_WGJets_ext->Get(TString(histname_signalRegion+"_21"));
  histo_ZnnG_WGJets_ext_ewkscaleUp_scaled->SetBinContent(nBins, histo_ZnnG_WGJets_ext_ewkscaleUp_scaled->GetBinContent(nBins)+histo_ZnnG_WGJets_ext_ewkscaleUp_scaled->GetBinContent(nBins+1));
  histo_ZnnG_WGJets_ext_ewkscaleUp_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_WGJets_ext_ewkscaleDown_scaled = (TH1F*)f_ZnnG_WGJets_ext->Get(TString(histname_signalRegion+"_22"));
  histo_ZnnG_WGJets_ext_ewkscaleDown_scaled->SetBinContent(nBins, histo_ZnnG_WGJets_ext_ewkscaleDown_scaled->GetBinContent(nBins)+histo_ZnnG_WGJets_ext_ewkscaleDown_scaled->GetBinContent(nBins+1));
  histo_ZnnG_WGJets_ext_ewkscaleDown_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_WGJets_ext_ewkshapeUp_scaled = (TH1F*)f_ZnnG_WGJets_ext->Get(TString(histname_signalRegion+"_31"));
  histo_ZnnG_WGJets_ext_ewkshapeUp_scaled->SetBinContent(nBins, histo_ZnnG_WGJets_ext_ewkshapeUp_scaled->GetBinContent(nBins)+histo_ZnnG_WGJets_ext_ewkshapeUp_scaled->GetBinContent(nBins+1));
  histo_ZnnG_WGJets_ext_ewkshapeUp_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_WGJets_ext_ewkshapeDown_scaled = (TH1F*)f_ZnnG_WGJets_ext->Get(TString(histname_signalRegion+"_32"));
  histo_ZnnG_WGJets_ext_ewkshapeDown_scaled->SetBinContent(nBins, histo_ZnnG_WGJets_ext_ewkshapeDown_scaled->GetBinContent(nBins)+histo_ZnnG_WGJets_ext_ewkshapeDown_scaled->GetBinContent(nBins+1));
  histo_ZnnG_WGJets_ext_ewkshapeDown_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_WGJets_ext_gammaUp_scaled = (TH1F*)f_ZnnG_WGJets_ext->Get(TString(histname_signalRegion+"_33"));
  histo_ZnnG_WGJets_ext_gammaUp_scaled->SetBinContent(nBins, histo_ZnnG_WGJets_ext_gammaUp_scaled->GetBinContent(nBins)+histo_ZnnG_WGJets_ext_gammaUp_scaled->GetBinContent(nBins+1));
  histo_ZnnG_WGJets_ext_gammaUp_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_WGJets_ext_gammaDown_scaled = (TH1F*)f_ZnnG_WGJets_ext->Get(TString(histname_signalRegion+"_34"));
  histo_ZnnG_WGJets_ext_gammaDown_scaled->SetBinContent(nBins, histo_ZnnG_WGJets_ext_gammaDown_scaled->GetBinContent(nBins)+histo_ZnnG_WGJets_ext_gammaDown_scaled->GetBinContent(nBins+1));
  histo_ZnnG_WGJets_ext_gammaDown_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_WGJets_ext_pdfUp_scaled = (TH1F*)f_ZnnG_WGJets_ext_pdfscale->Get("h_ZnnG_pdfscale_WGJets_ext_pdfUp_unscaled");
  TH1F* histo_ZnnG_WGJets_ext_pdfDown_scaled = (TH1F*)f_ZnnG_WGJets_ext_pdfscale->Get("h_ZnnG_pdfscale_WGJets_ext_pdfDown_unscaled");
  TH1F* histo_ZnnG_WGJets_ext_qcdscale_scaled = (TH1F*)f_ZnnG_WGJets_ext->Get(TString(histname_signalRegion+"_23"));
  histo_ZnnG_WGJets_ext_qcdscale_scaled->SetBinContent(nBins, histo_ZnnG_WGJets_ext_qcdscale_scaled->GetBinContent(nBins)+histo_ZnnG_WGJets_ext_qcdscale_scaled->GetBinContent(nBins+1));
  histo_ZnnG_WGJets_ext_qcdscale_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_WGJets_mitExt_ewkscaleUp_scaled = (TH1F*)f_ZnnG_WGJets_mitExt->Get(TString(histname_signalRegion+"_21"));
  histo_ZnnG_WGJets_mitExt_ewkscaleUp_scaled->SetBinContent(nBins, histo_ZnnG_WGJets_mitExt_ewkscaleUp_scaled->GetBinContent(nBins)+histo_ZnnG_WGJets_mitExt_ewkscaleUp_scaled->GetBinContent(nBins+1));
  histo_ZnnG_WGJets_mitExt_ewkscaleUp_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_WGJets_mitExt_ewkscaleDown_scaled = (TH1F*)f_ZnnG_WGJets_mitExt->Get(TString(histname_signalRegion+"_22"));
  histo_ZnnG_WGJets_mitExt_ewkscaleDown_scaled->SetBinContent(nBins, histo_ZnnG_WGJets_mitExt_ewkscaleDown_scaled->GetBinContent(nBins)+histo_ZnnG_WGJets_mitExt_ewkscaleDown_scaled->GetBinContent(nBins+1));
  histo_ZnnG_WGJets_mitExt_ewkscaleDown_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_WGJets_mitExt_ewkshapeUp_scaled = (TH1F*)f_ZnnG_WGJets_mitExt->Get(TString(histname_signalRegion+"_31"));
  histo_ZnnG_WGJets_mitExt_ewkshapeUp_scaled->SetBinContent(nBins, histo_ZnnG_WGJets_mitExt_ewkshapeUp_scaled->GetBinContent(nBins)+histo_ZnnG_WGJets_mitExt_ewkshapeUp_scaled->GetBinContent(nBins+1));
  histo_ZnnG_WGJets_mitExt_ewkshapeUp_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_WGJets_mitExt_ewkshapeDown_scaled = (TH1F*)f_ZnnG_WGJets_mitExt->Get(TString(histname_signalRegion+"_32"));
  histo_ZnnG_WGJets_mitExt_ewkshapeDown_scaled->SetBinContent(nBins, histo_ZnnG_WGJets_mitExt_ewkshapeDown_scaled->GetBinContent(nBins)+histo_ZnnG_WGJets_mitExt_ewkshapeDown_scaled->GetBinContent(nBins+1));
  histo_ZnnG_WGJets_mitExt_ewkshapeDown_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_WGJets_mitExt_gammaUp_scaled = (TH1F*)f_ZnnG_WGJets_mitExt->Get(TString(histname_signalRegion+"_33"));
  histo_ZnnG_WGJets_mitExt_gammaUp_scaled->SetBinContent(nBins, histo_ZnnG_WGJets_mitExt_gammaUp_scaled->GetBinContent(nBins)+histo_ZnnG_WGJets_mitExt_gammaUp_scaled->GetBinContent(nBins+1));
  histo_ZnnG_WGJets_mitExt_gammaUp_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_WGJets_mitExt_gammaDown_scaled = (TH1F*)f_ZnnG_WGJets_mitExt->Get(TString(histname_signalRegion+"_34"));
  histo_ZnnG_WGJets_mitExt_gammaDown_scaled->SetBinContent(nBins, histo_ZnnG_WGJets_mitExt_gammaDown_scaled->GetBinContent(nBins)+histo_ZnnG_WGJets_mitExt_gammaDown_scaled->GetBinContent(nBins+1));
  histo_ZnnG_WGJets_mitExt_gammaDown_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_WGJets_mitExt_pdfUp_scaled = (TH1F*)f_ZnnG_WGJets_mitExt_pdfscale->Get("h_ZnnG_pdfscale_WGJets_mitExt_pdfUp_unscaled");
  TH1F* histo_ZnnG_WGJets_mitExt_pdfDown_scaled = (TH1F*)f_ZnnG_WGJets_mitExt_pdfscale->Get("h_ZnnG_pdfscale_WGJets_mitExt_pdfDown_unscaled");
  TH1F* histo_ZnnG_WGJets_mitExt_qcdscale_scaled = (TH1F*)f_ZnnG_WGJets_mitExt->Get(TString(histname_signalRegion+"_23"));
  histo_ZnnG_WGJets_mitExt_qcdscale_scaled->SetBinContent(nBins, histo_ZnnG_WGJets_mitExt_qcdscale_scaled->GetBinContent(nBins)+histo_ZnnG_WGJets_mitExt_qcdscale_scaled->GetBinContent(nBins+1));
  histo_ZnnG_WGJets_mitExt_qcdscale_scaled->ClearUnderflowAndOverflow();
  histo_ZnnG_WGJets_ewkscaleUp_scaled->Add(histo_ZnnG_WGJets_ext_ewkscaleUp_scaled);
  histo_ZnnG_WGJets_ewkscaleDown_scaled->Add(histo_ZnnG_WGJets_ext_ewkscaleDown_scaled);
  histo_ZnnG_WGJets_ewkshapeUp_scaled->Add(histo_ZnnG_WGJets_ext_ewkshapeUp_scaled);
  histo_ZnnG_WGJets_ewkshapeDown_scaled->Add(histo_ZnnG_WGJets_ext_ewkshapeDown_scaled);
  histo_ZnnG_WGJets_gammaUp_scaled->Add(histo_ZnnG_WGJets_ext_gammaUp_scaled);
  histo_ZnnG_WGJets_gammaDown_scaled->Add(histo_ZnnG_WGJets_ext_gammaDown_scaled);
  histo_ZnnG_WGJets_pdfUp_scaled->Add(histo_ZnnG_WGJets_ext_pdfUp_scaled);
  histo_ZnnG_WGJets_pdfDown_scaled->Add(histo_ZnnG_WGJets_ext_pdfDown_scaled);
  histo_ZnnG_WGJets_qcdscale_scaled->Add(histo_ZnnG_WGJets_ext_qcdscale_scaled);
  histo_ZnnG_WGJets_ewkscaleUp_scaled->Add(histo_ZnnG_WGJets_mitExt_ewkscaleUp_scaled);
  histo_ZnnG_WGJets_ewkscaleDown_scaled->Add(histo_ZnnG_WGJets_mitExt_ewkscaleDown_scaled);
  histo_ZnnG_WGJets_ewkshapeUp_scaled->Add(histo_ZnnG_WGJets_mitExt_ewkshapeUp_scaled);
  histo_ZnnG_WGJets_ewkshapeDown_scaled->Add(histo_ZnnG_WGJets_mitExt_ewkshapeDown_scaled);
  histo_ZnnG_WGJets_gammaUp_scaled->Add(histo_ZnnG_WGJets_mitExt_gammaUp_scaled);
  histo_ZnnG_WGJets_gammaDown_scaled->Add(histo_ZnnG_WGJets_mitExt_gammaDown_scaled);
  histo_ZnnG_WGJets_pdfUp_scaled->Add(histo_ZnnG_WGJets_mitExt_pdfUp_scaled);
  histo_ZnnG_WGJets_pdfDown_scaled->Add(histo_ZnnG_WGJets_mitExt_pdfDown_scaled);
  histo_ZnnG_WGJets_qcdscale_scaled->Add(histo_ZnnG_WGJets_mitExt_qcdscale_scaled);
  // histo_ZnnG_WGJets_*_scaled contains all passing WGJets events
  histo_ZnnG_WGJets_ewkscaleUp_scaled->Scale(0.65521/30469887.0);
  histo_ZnnG_WGJets_ewkscaleDown_scaled->Scale(0.65521/30469887.0);
  histo_ZnnG_WGJets_ewkshapeUp_scaled->Scale(0.65521/30469887.0);
  histo_ZnnG_WGJets_ewkshapeDown_scaled->Scale(0.65521/30469887.0);
  histo_ZnnG_WGJets_gammaUp_scaled->Scale(0.65521/30469887.0);
  histo_ZnnG_WGJets_gammaDown_scaled->Scale(0.65521/30469887.0);
  histo_ZnnG_WGJets_pdfUp_scaled->Scale(0.65521/30469887.0);
  histo_ZnnG_WGJets_pdfDown_scaled->Scale(0.65521/30469887.0);
  histo_ZnnG_WGJets_qcdscale_scaled->Scale(0.65521/30469887.0);
  // DEBUG
  // cout<<"Second scaling block done"<<endl;
  
  // Scaled ZNuNuGJets variations, ZnnG region
  TH1F* histo_ZnnG_ZNuNuGJets_ewkscaleUp_scaled = (TH1F*)f_ZnnG_ZNuNuGJets->Get(TString(histname_signalRegion+"_21"));
  histo_ZnnG_ZNuNuGJets_ewkscaleUp_scaled->SetBinContent(nBins, histo_ZnnG_ZNuNuGJets_ewkscaleUp_scaled->GetBinContent(nBins)+histo_ZnnG_ZNuNuGJets_ewkscaleUp_scaled->GetBinContent(nBins+1));
  histo_ZnnG_ZNuNuGJets_ewkscaleUp_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_ZNuNuGJets_ewkscaleDown_scaled = (TH1F*)f_ZnnG_ZNuNuGJets->Get(TString(histname_signalRegion+"_22"));
  histo_ZnnG_ZNuNuGJets_ewkscaleDown_scaled->SetBinContent(nBins, histo_ZnnG_ZNuNuGJets_ewkscaleDown_scaled->GetBinContent(nBins)+histo_ZnnG_ZNuNuGJets_ewkscaleDown_scaled->GetBinContent(nBins+1));
  histo_ZnnG_ZNuNuGJets_ewkscaleDown_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_ZNuNuGJets_ewkshapeUp_scaled = (TH1F*)f_ZnnG_ZNuNuGJets->Get(TString(histname_signalRegion+"_31"));
  histo_ZnnG_ZNuNuGJets_ewkshapeUp_scaled->SetBinContent(nBins, histo_ZnnG_ZNuNuGJets_ewkshapeUp_scaled->GetBinContent(nBins)+histo_ZnnG_ZNuNuGJets_ewkshapeUp_scaled->GetBinContent(nBins+1));
  histo_ZnnG_ZNuNuGJets_ewkshapeUp_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_ZNuNuGJets_ewkshapeDown_scaled = (TH1F*)f_ZnnG_ZNuNuGJets->Get(TString(histname_signalRegion+"_32"));
  histo_ZnnG_ZNuNuGJets_ewkshapeDown_scaled->SetBinContent(nBins, histo_ZnnG_ZNuNuGJets_ewkshapeDown_scaled->GetBinContent(nBins)+histo_ZnnG_ZNuNuGJets_ewkshapeDown_scaled->GetBinContent(nBins+1));
  histo_ZnnG_ZNuNuGJets_ewkshapeDown_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_ZNuNuGJets_gammaUp_scaled = (TH1F*)f_ZnnG_ZNuNuGJets->Get(TString(histname_signalRegion+"_33"));
  histo_ZnnG_ZNuNuGJets_gammaUp_scaled->SetBinContent(nBins, histo_ZnnG_ZNuNuGJets_gammaUp_scaled->GetBinContent(nBins)+histo_ZnnG_ZNuNuGJets_gammaUp_scaled->GetBinContent(nBins+1));
  histo_ZnnG_ZNuNuGJets_gammaUp_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_ZNuNuGJets_gammaDown_scaled = (TH1F*)f_ZnnG_ZNuNuGJets->Get(TString(histname_signalRegion+"_34"));
  histo_ZnnG_ZNuNuGJets_gammaDown_scaled->SetBinContent(nBins, histo_ZnnG_ZNuNuGJets_gammaDown_scaled->GetBinContent(nBins)+histo_ZnnG_ZNuNuGJets_gammaDown_scaled->GetBinContent(nBins+1));
  histo_ZnnG_ZNuNuGJets_gammaDown_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_ZNuNuGJets_pdfUp_scaled = (TH1F*)f_ZnnG_ZNuNuGJets_pdfscale->Get("h_ZnnG_pdfscale_ZNuNuGJets_pdfUp_unscaled");
  TH1F* histo_ZnnG_ZNuNuGJets_pdfDown_scaled = (TH1F*)f_ZnnG_ZNuNuGJets_pdfscale->Get("h_ZnnG_pdfscale_ZNuNuGJets_pdfDown_unscaled");
  TH1F* histo_ZnnG_ZNuNuGJets_qcdscale_scaled = (TH1F*)f_ZnnG_ZNuNuGJets->Get(TString(histname_signalRegion+"_23"));
  histo_ZnnG_ZNuNuGJets_qcdscale_scaled->SetBinContent(nBins, histo_ZnnG_ZNuNuGJets_qcdscale_scaled->GetBinContent(nBins)+histo_ZnnG_ZNuNuGJets_qcdscale_scaled->GetBinContent(nBins+1));
  histo_ZnnG_ZNuNuGJets_qcdscale_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_ZNuNuGJets_ext_ewkscaleUp_scaled = (TH1F*)f_ZnnG_ZNuNuGJets_ext->Get(TString(histname_signalRegion+"_21"));
  histo_ZnnG_ZNuNuGJets_ext_ewkscaleUp_scaled->SetBinContent(nBins, histo_ZnnG_ZNuNuGJets_ext_ewkscaleUp_scaled->GetBinContent(nBins)+histo_ZnnG_ZNuNuGJets_ext_ewkscaleUp_scaled->GetBinContent(nBins+1));
  histo_ZnnG_ZNuNuGJets_ext_ewkscaleUp_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_ZNuNuGJets_ext_ewkscaleDown_scaled = (TH1F*)f_ZnnG_ZNuNuGJets_ext->Get(TString(histname_signalRegion+"_22"));
  histo_ZnnG_ZNuNuGJets_ext_ewkscaleDown_scaled->SetBinContent(nBins, histo_ZnnG_ZNuNuGJets_ext_ewkscaleDown_scaled->GetBinContent(nBins)+histo_ZnnG_ZNuNuGJets_ext_ewkscaleDown_scaled->GetBinContent(nBins+1));
  histo_ZnnG_ZNuNuGJets_ext_ewkscaleDown_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_ZNuNuGJets_ext_ewkshapeUp_scaled = (TH1F*)f_ZnnG_ZNuNuGJets_ext->Get(TString(histname_signalRegion+"_31"));
  histo_ZnnG_ZNuNuGJets_ext_ewkshapeUp_scaled->SetBinContent(nBins, histo_ZnnG_ZNuNuGJets_ext_ewkshapeUp_scaled->GetBinContent(nBins)+histo_ZnnG_ZNuNuGJets_ext_ewkshapeUp_scaled->GetBinContent(nBins+1));
  histo_ZnnG_ZNuNuGJets_ext_ewkshapeUp_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_ZNuNuGJets_ext_ewkshapeDown_scaled = (TH1F*)f_ZnnG_ZNuNuGJets_ext->Get(TString(histname_signalRegion+"_32"));
  histo_ZnnG_ZNuNuGJets_ext_ewkshapeDown_scaled->SetBinContent(nBins, histo_ZnnG_ZNuNuGJets_ext_ewkshapeDown_scaled->GetBinContent(nBins)+histo_ZnnG_ZNuNuGJets_ext_ewkshapeDown_scaled->GetBinContent(nBins+1));
  histo_ZnnG_ZNuNuGJets_ext_ewkshapeDown_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_ZNuNuGJets_ext_gammaUp_scaled = (TH1F*)f_ZnnG_ZNuNuGJets_ext->Get(TString(histname_signalRegion+"_33"));
  histo_ZnnG_ZNuNuGJets_ext_gammaUp_scaled->SetBinContent(nBins, histo_ZnnG_ZNuNuGJets_ext_gammaUp_scaled->GetBinContent(nBins)+histo_ZnnG_ZNuNuGJets_ext_gammaUp_scaled->GetBinContent(nBins+1));
  histo_ZnnG_ZNuNuGJets_ext_gammaUp_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_ZNuNuGJets_ext_gammaDown_scaled = (TH1F*)f_ZnnG_ZNuNuGJets_ext->Get(TString(histname_signalRegion+"_34"));
  histo_ZnnG_ZNuNuGJets_ext_gammaDown_scaled->SetBinContent(nBins, histo_ZnnG_ZNuNuGJets_ext_gammaDown_scaled->GetBinContent(nBins)+histo_ZnnG_ZNuNuGJets_ext_gammaDown_scaled->GetBinContent(nBins+1));
  histo_ZnnG_ZNuNuGJets_ext_gammaDown_scaled->ClearUnderflowAndOverflow();
  TH1F* histo_ZnnG_ZNuNuGJets_ext_pdfUp_scaled = (TH1F*)f_ZnnG_ZNuNuGJets_ext_pdfscale->Get("h_ZnnG_pdfscale_ZNuNuGJets_ext_pdfUp_unscaled");
  TH1F* histo_ZnnG_ZNuNuGJets_ext_pdfDown_scaled = (TH1F*)f_ZnnG_ZNuNuGJets_ext_pdfscale->Get("h_ZnnG_pdfscale_ZNuNuGJets_ext_pdfDown_unscaled");
  TH1F* histo_ZnnG_ZNuNuGJets_ext_qcdscale_scaled = (TH1F*)f_ZnnG_ZNuNuGJets_ext->Get(TString(histname_signalRegion+"_23"));
  histo_ZnnG_ZNuNuGJets_ext_qcdscale_scaled->SetBinContent(nBins, histo_ZnnG_ZNuNuGJets_ext_qcdscale_scaled->GetBinContent(nBins)+histo_ZnnG_ZNuNuGJets_ext_qcdscale_scaled->GetBinContent(nBins+1));
  histo_ZnnG_ZNuNuGJets_ext_qcdscale_scaled->ClearUnderflowAndOverflow();
  histo_ZnnG_ZNuNuGJets_ewkscaleUp_scaled->Add(histo_ZnnG_ZNuNuGJets_ext_ewkscaleUp_scaled);
  histo_ZnnG_ZNuNuGJets_ewkscaleDown_scaled->Add(histo_ZnnG_ZNuNuGJets_ext_ewkscaleDown_scaled);
  histo_ZnnG_ZNuNuGJets_ewkshapeUp_scaled->Add(histo_ZnnG_ZNuNuGJets_ext_ewkshapeUp_scaled);
  histo_ZnnG_ZNuNuGJets_ewkshapeDown_scaled->Add(histo_ZnnG_ZNuNuGJets_ext_ewkshapeDown_scaled);
  histo_ZnnG_ZNuNuGJets_gammaUp_scaled->Add(histo_ZnnG_ZNuNuGJets_ext_gammaUp_scaled);
  histo_ZnnG_ZNuNuGJets_gammaDown_scaled->Add(histo_ZnnG_ZNuNuGJets_ext_gammaDown_scaled);
  histo_ZnnG_ZNuNuGJets_pdfUp_scaled->Add(histo_ZnnG_ZNuNuGJets_ext_pdfUp_scaled);
  histo_ZnnG_ZNuNuGJets_pdfDown_scaled->Add(histo_ZnnG_ZNuNuGJets_ext_pdfDown_scaled);
  histo_ZnnG_ZNuNuGJets_qcdscale_scaled->Add(histo_ZnnG_ZNuNuGJets_ext_qcdscale_scaled);
  // histo_ZnnG_ZNuNuGJets_*_scaled contains all passing ZNuNuGJets events
  histo_ZnnG_ZNuNuGJets_ewkscaleUp_scaled->Scale(0.18213/2040365.0);
  histo_ZnnG_ZNuNuGJets_ewkscaleDown_scaled->Scale(0.18213/2040365.0);
  histo_ZnnG_ZNuNuGJets_ewkshapeUp_scaled->Scale(0.18213/2040365.0);
  histo_ZnnG_ZNuNuGJets_ewkshapeDown_scaled->Scale(0.18213/2040365.0);
  histo_ZnnG_ZNuNuGJets_gammaUp_scaled->Scale(0.18213/2040365.0);
  histo_ZnnG_ZNuNuGJets_gammaDown_scaled->Scale(0.18213/2040365.0);
  histo_ZnnG_ZNuNuGJets_pdfUp_scaled->Scale(0.18213/2040365.0);
  histo_ZnnG_ZNuNuGJets_pdfDown_scaled->Scale(0.18213/2040365.0);
  histo_ZnnG_ZNuNuGJets_qcdscale_scaled->Scale(0.18213/2040365.0);
  // DEBUG
  // cout<<"Third scaling block done"<<endl;
  
  ///////////////////////////////////
  // Evaluate the transfer factors //
  ///////////////////////////////////
    
  // WGinZnnG_to_ZnnGinZnnG
  TGraphErrors *transfer_factor_stat = new TGraphErrors();
  TGraphErrors *transfer_factor_syst = new TGraphErrors();
  TGraphErrors *transfer_factor_combined = new TGraphErrors();
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_noShift = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_noShift");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_ewkscale_shiftUp = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_ewkscale_shiftUp");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_ewkscale_shiftDown = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_ewkscale_shiftDown");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_ewkshape_shiftUp = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_ewkshape_shiftUp");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_ewkshape_shiftDown = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_ewkshape_shiftDown");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_gamma_shiftUp = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_gamma_shiftUp");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_gamma_shiftDown = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_gamma_shiftDown");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_ewkscale_shiftUp = (TH1F*)histo_ZnnG_WGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_ewkscale_shiftUp");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_ewkscale_shiftDown = (TH1F*)histo_ZnnG_WGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_ewkscale_shiftDown");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_ewkshape_shiftUp = (TH1F*)histo_ZnnG_WGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_ewkshape_shiftUp");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_ewkshape_shiftDown = (TH1F*)histo_ZnnG_WGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_ewkshape_shiftDown");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_gamma_shiftUp = (TH1F*)histo_ZnnG_WGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_gamma_shiftUp");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_gamma_shiftDown = (TH1F*)histo_ZnnG_WGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_gamma_shiftDown");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_ewkscale_shiftUp = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_ewkscale_shiftUp");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_ewkscale_shiftDown = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_ewkscale_shiftDown");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_ewkshape_shiftUp = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_ewkshape_shiftUp");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_ewkshape_shiftDown = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_ewkshape_shiftDown");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_gamma_shiftUp = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_gamma_shiftUp");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_gamma_shiftDown = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_gamma_shiftDown");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_ewkscale_shiftUp = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_ewkscale_shiftUp");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_ewkscale_shiftDown = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_ewkscale_shiftDown");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_ewkshape_shiftUp = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_ewkshape_shiftUp");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_ewkshape_shiftDown = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_ewkshape_shiftDown");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_gamma_shiftUp = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_gamma_shiftUp");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_gamma_shiftDown = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_gamma_shiftDown");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_pdf_shiftUp = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_pdf_shiftUp");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_pdf_shiftDown = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_pdf_shiftDown");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_qcdscale_shiftUp = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_qcdscale_shiftUp");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_qcdscale_shiftDown = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_qcdscale_shiftDown");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_qcdscale_shiftUp = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_qcdscale_shiftUp");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_qcdscale_shiftDown = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_qcdscale_shiftDown");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_qcdscale_shiftUp = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_qcdscale_shiftUp");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_qcdscale_shiftDown = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_qcdscale_shiftDown");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_qcdscale_shiftUp = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_qcdscale_shiftUp");
  TH1F *transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_qcdscale_shiftDown = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_qcdscale_shiftDown");
  TH1F *transfer_shift_noShift = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_shift_noShift");
  TH1F *transfer_shift_ZNuNuGJets_ewkscale_shiftUp = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_shift_ewkscale_shiftUp");
  TH1F *transfer_shift_ZNuNuGJets_ewkscale_shiftDown = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_shift_ewkscale_shiftDown");
  TH1F *transfer_shift_ZNuNuGJets_ewkshape_shiftUp = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_shift_ewkshape_shiftUp");
  TH1F *transfer_shift_ZNuNuGJets_ewkshape_shiftDown = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_shift_ewkshape_shiftDown");
  TH1F *transfer_shift_ZNuNuGJets_gamma_shiftUp = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_shift_gamma_shiftUp");
  TH1F *transfer_shift_ZNuNuGJets_gamma_shiftDown = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_shift_gamma_shiftDown");
  TH1F *transfer_shift_WGJets_ewkscale_shiftUp = (TH1F*)histo_ZnnG_WGJets_scaled->Clone("transfer_shift_ewkscale_shiftUp");
  TH1F *transfer_shift_WGJets_ewkscale_shiftDown = (TH1F*)histo_ZnnG_WGJets_scaled->Clone("transfer_shift_ewkscale_shiftDown");
  TH1F *transfer_shift_WGJets_ewkshape_shiftUp = (TH1F*)histo_ZnnG_WGJets_scaled->Clone("transfer_shift_ewkshape_shiftUp");
  TH1F *transfer_shift_WGJets_ewkshape_shiftDown = (TH1F*)histo_ZnnG_WGJets_scaled->Clone("transfer_shift_ewkshape_shiftDown");
  TH1F *transfer_shift_WGJets_gamma_shiftUp = (TH1F*)histo_ZnnG_WGJets_scaled->Clone("transfer_shift_gamma_shiftUp");
  TH1F *transfer_shift_WGJets_gamma_shiftDown = (TH1F*)histo_ZnnG_WGJets_scaled->Clone("transfer_shift_gamma_shiftDown");
  TH1F *transfer_shift_pdf_shiftUp = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_shift_pdf_shiftUp");
  TH1F *transfer_shift_pdf_shiftDown = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_shift_pdf_shiftDown");
  TH1F *transfer_shift_ZNuNuGJets_qcdscale_shiftUp = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_shift_ZNuNuGJets_qcdscale_shiftUp");
  TH1F *transfer_shift_ZNuNuGJets_qcdscale_shiftDown = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_shift_ZNuNuGJets_qcdscale_shiftDown");
  TH1F *transfer_shift_WGJets_qcdscale_shiftUp = (TH1F*)histo_ZnnG_WGJets_scaled->Clone("transfer_shift_WGJets_qcdscale_shiftUp");
  TH1F *transfer_shift_WGJets_qcdscale_shiftDown = (TH1F*)histo_ZnnG_WGJets_scaled->Clone("transfer_shift_WGJets_qcdscale_shiftDown");
  for(int i = 1; i <= nBins; i++){
    Double_t x_value = histo_ZnnG_ZNuNuGJets_scaled->GetBinCenter(i);
    Double_t x_halfwidth = (histo_ZnnG_ZNuNuGJets_scaled->GetBinWidth(i))/2.0;
    Double_t y_value = 0.0;
    Double_t y_value_ZNuNuGJets_ewkscaleUp = 0.0;
    Double_t y_value_ZNuNuGJets_ewkscaleDown = 0.0;
    Double_t y_value_ZNuNuGJets_ewkshapeUp = 0.0;
    Double_t y_value_ZNuNuGJets_ewkshapeDown = 0.0;
    Double_t y_value_ZNuNuGJets_gammaUp = 0.0;
    Double_t y_value_ZNuNuGJets_gammaDown = 0.0;
    Double_t y_value_WGJets_ewkscaleUp = 0.0;
    Double_t y_value_WGJets_ewkscaleDown = 0.0;
    Double_t y_value_WGJets_ewkshapeUp = 0.0;
    Double_t y_value_WGJets_ewkshapeDown = 0.0;
    Double_t y_value_WGJets_gammaUp = 0.0;
    Double_t y_value_WGJets_gammaDown = 0.0;
    Double_t y_value_correlated_ewkscaleUp = 0.0;
    Double_t y_value_correlated_ewkscaleDown = 0.0;
    Double_t y_value_correlated_ewkshapeUp = 0.0;
    Double_t y_value_correlated_ewkshapeDown = 0.0;
    Double_t y_value_correlated_gammaUp = 0.0;
    Double_t y_value_correlated_gammaDown = 0.0;
    Double_t y_value_anticorrelated_ewkscaleUp = 0.0;
    Double_t y_value_anticorrelated_ewkscaleDown = 0.0;
    Double_t y_value_anticorrelated_ewkshapeUp = 0.0;
    Double_t y_value_anticorrelated_ewkshapeDown = 0.0;
    Double_t y_value_anticorrelated_gammaUp = 0.0;
    Double_t y_value_anticorrelated_gammaDown = 0.0;
    Double_t y_value_pdfUp = 0.0;
    Double_t y_value_pdfDown = 0.0;
    Double_t y_value_ZNuNuGJets_qcdscaleUp = 0.0;
    Double_t y_value_ZNuNuGJets_qcdscaleDown = 0.0;
    Double_t y_value_WGJets_qcdscaleUp = 0.0;
    Double_t y_value_WGJets_qcdscaleDown = 0.0;
    Double_t y_value_correlated_qcdscaleUp = 0.0;
    Double_t y_value_correlated_qcdscaleDown = 0.0;
    Double_t y_value_anticorrelated_qcdscaleUp = 0.0;
    Double_t y_value_anticorrelated_qcdscaleDown = 0.0;
    Double_t y_error_stat = 0.0;
    Double_t y_error_syst_ZNuNuGJets_ewkscale = 0.0;
    Double_t y_error_syst_ZNuNuGJets_ewkshape = 0.0;
    Double_t y_error_syst_ZNuNuGJets_gamma = 0.0;
    Double_t y_error_syst_WGJets_ewkscale = 0.0;
    Double_t y_error_syst_WGJets_ewkshape = 0.0;
    Double_t y_error_syst_WGJets_gamma = 0.0;
    Double_t y_error_syst_pdf = 0.0;
    Double_t y_error_syst_ZNuNuGJets_qcdscale = 0.0;
    Double_t y_error_syst_WGJets_qcdscale = 0.0;
    Double_t y_error_syst_combined = 0.0;
    Double_t y_error_combined = 0.0;
    if(histo_ZnnG_ZNuNuGJets_scaled->GetBinContent(i) > 0.0){
      Double_t N_bin_WGinZnnG = histo_ZnnG_WGJets_scaled->GetBinContent(i);
      Double_t N_bin_WGinZnnG_ewkscaleUp = histo_ZnnG_WGJets_ewkscaleUp_scaled->GetBinContent(i);
      Double_t N_bin_WGinZnnG_ewkscaleDown = histo_ZnnG_WGJets_ewkscaleDown_scaled->GetBinContent(i);
      Double_t N_bin_WGinZnnG_ewkshapeUp = histo_ZnnG_WGJets_ewkshapeUp_scaled->GetBinContent(i);
      Double_t N_bin_WGinZnnG_ewkshapeDown = histo_ZnnG_WGJets_ewkshapeDown_scaled->GetBinContent(i);
      Double_t N_bin_WGinZnnG_gammaUp = histo_ZnnG_WGJets_gammaUp_scaled->GetBinContent(i);
      Double_t N_bin_WGinZnnG_gammaDown = histo_ZnnG_WGJets_gammaDown_scaled->GetBinContent(i);
      Double_t N_bin_WGinZnnG_pdfUp = histo_ZnnG_WGJets_pdfUp_scaled->GetBinContent(i);
      Double_t N_bin_WGinZnnG_pdfDown = histo_ZnnG_WGJets_pdfDown_scaled->GetBinContent(i);
      Double_t N_bin_WGinZnnG_qcdscaleUp = histo_ZnnG_WGJets_qcdscale_scaled->GetBinContent(i);
      Double_t N_bin_ZnnGinZnnG = histo_ZnnG_ZNuNuGJets_scaled->GetBinContent(i);
      Double_t N_bin_ZnnGinZnnG_ewkscaleUp = histo_ZnnG_ZNuNuGJets_ewkscaleUp_scaled->GetBinContent(i);
      Double_t N_bin_ZnnGinZnnG_ewkscaleDown = histo_ZnnG_ZNuNuGJets_ewkscaleDown_scaled->GetBinContent(i);
      Double_t N_bin_ZnnGinZnnG_ewkshapeUp = histo_ZnnG_ZNuNuGJets_ewkshapeUp_scaled->GetBinContent(i);
      Double_t N_bin_ZnnGinZnnG_ewkshapeDown = histo_ZnnG_ZNuNuGJets_ewkshapeDown_scaled->GetBinContent(i);
      Double_t N_bin_ZnnGinZnnG_gammaUp = histo_ZnnG_ZNuNuGJets_gammaUp_scaled->GetBinContent(i);
      Double_t N_bin_ZnnGinZnnG_gammaDown = histo_ZnnG_ZNuNuGJets_gammaDown_scaled->GetBinContent(i);
      Double_t N_bin_ZnnGinZnnG_pdfUp = histo_ZnnG_ZNuNuGJets_pdfUp_scaled->GetBinContent(i);
      Double_t N_bin_ZnnGinZnnG_pdfDown = histo_ZnnG_ZNuNuGJets_pdfDown_scaled->GetBinContent(i);
      Double_t N_bin_ZnnGinZnnG_qcdscaleUp = histo_ZnnG_ZNuNuGJets_qcdscale_scaled->GetBinContent(i);
      y_value = N_bin_ZnnGinZnnG / N_bin_WGinZnnG;
      y_value_ZNuNuGJets_ewkscaleUp = N_bin_ZnnGinZnnG_ewkscaleUp / N_bin_WGinZnnG;
      y_value_ZNuNuGJets_ewkscaleDown = N_bin_ZnnGinZnnG_ewkscaleDown / N_bin_WGinZnnG;
      y_value_ZNuNuGJets_ewkshapeUp = N_bin_ZnnGinZnnG_ewkshapeUp / N_bin_WGinZnnG;
      y_value_ZNuNuGJets_ewkshapeDown = N_bin_ZnnGinZnnG_ewkshapeDown / N_bin_WGinZnnG;
      y_value_ZNuNuGJets_gammaUp = N_bin_ZnnGinZnnG_gammaUp / N_bin_WGinZnnG;
      y_value_ZNuNuGJets_gammaDown = N_bin_ZnnGinZnnG_gammaDown / N_bin_WGinZnnG;
      y_value_WGJets_ewkscaleUp = N_bin_ZnnGinZnnG / N_bin_WGinZnnG_ewkscaleUp;
      y_value_WGJets_ewkscaleDown = N_bin_ZnnGinZnnG / N_bin_WGinZnnG_ewkscaleDown;
      y_value_WGJets_ewkshapeUp = N_bin_ZnnGinZnnG / N_bin_WGinZnnG_ewkshapeUp;
      y_value_WGJets_ewkshapeDown = N_bin_ZnnGinZnnG / N_bin_WGinZnnG_ewkshapeDown;
      y_value_WGJets_gammaUp = N_bin_ZnnGinZnnG / N_bin_WGinZnnG_gammaUp;
      y_value_WGJets_gammaDown = N_bin_ZnnGinZnnG / N_bin_WGinZnnG_gammaDown;
      y_value_correlated_ewkscaleUp = N_bin_ZnnGinZnnG_ewkscaleUp / N_bin_WGinZnnG_ewkscaleUp;
      y_value_correlated_ewkscaleDown = N_bin_ZnnGinZnnG_ewkscaleDown / N_bin_WGinZnnG_ewkscaleDown;
      y_value_correlated_ewkshapeUp = N_bin_ZnnGinZnnG_ewkshapeUp / N_bin_WGinZnnG_ewkshapeUp;
      y_value_correlated_ewkshapeDown = N_bin_ZnnGinZnnG_ewkshapeDown / N_bin_WGinZnnG_ewkshapeDown;
      y_value_correlated_gammaUp = N_bin_ZnnGinZnnG_gammaUp / N_bin_WGinZnnG_gammaUp;
      y_value_correlated_gammaDown = N_bin_ZnnGinZnnG_gammaDown / N_bin_WGinZnnG_gammaDown;
      y_value_anticorrelated_ewkscaleUp = N_bin_ZnnGinZnnG_ewkscaleUp / N_bin_WGinZnnG_ewkscaleDown;
      y_value_anticorrelated_ewkscaleDown = N_bin_ZnnGinZnnG_ewkscaleDown / N_bin_WGinZnnG_ewkscaleUp;
      y_value_anticorrelated_ewkshapeUp = N_bin_ZnnGinZnnG_ewkshapeUp / N_bin_WGinZnnG_ewkshapeDown;
      y_value_anticorrelated_ewkshapeDown = N_bin_ZnnGinZnnG_ewkshapeDown / N_bin_WGinZnnG_ewkshapeUp;
      y_value_anticorrelated_gammaUp = N_bin_ZnnGinZnnG_gammaUp / N_bin_WGinZnnG_gammaDown;
      y_value_anticorrelated_gammaDown = N_bin_ZnnGinZnnG_gammaDown / N_bin_WGinZnnG_gammaUp;
      y_value_pdfUp = N_bin_ZnnGinZnnG_pdfUp / N_bin_WGinZnnG_pdfUp;
      y_value_pdfDown = N_bin_ZnnGinZnnG_pdfDown / N_bin_WGinZnnG_pdfDown;
      y_value_ZNuNuGJets_qcdscaleUp = N_bin_ZnnGinZnnG_qcdscaleUp / N_bin_WGinZnnG;
      y_value_ZNuNuGJets_qcdscaleDown = (2.*N_bin_ZnnGinZnnG-N_bin_ZnnGinZnnG_qcdscaleUp) / N_bin_WGinZnnG;
      y_value_WGJets_qcdscaleUp = N_bin_ZnnGinZnnG / N_bin_WGinZnnG_qcdscaleUp;
      y_value_WGJets_qcdscaleDown = N_bin_ZnnGinZnnG / (2.*N_bin_WGinZnnG-N_bin_WGinZnnG_qcdscaleUp);
      y_value_correlated_qcdscaleUp = N_bin_ZnnGinZnnG_qcdscaleUp / N_bin_WGinZnnG_qcdscaleUp;
      y_value_correlated_qcdscaleDown = (2.*N_bin_ZnnGinZnnG-N_bin_ZnnGinZnnG_qcdscaleUp) / (2.*N_bin_WGinZnnG-N_bin_WGinZnnG_qcdscaleUp);
      y_value_anticorrelated_qcdscaleUp = N_bin_ZnnGinZnnG_qcdscaleUp / (2.*N_bin_WGinZnnG-N_bin_WGinZnnG_qcdscaleUp);
      y_value_anticorrelated_qcdscaleDown = (2.*N_bin_ZnnGinZnnG-N_bin_ZnnGinZnnG_qcdscaleUp) / N_bin_WGinZnnG_qcdscaleUp;
      y_error_stat = y_value*sqrt((0.65521-N_bin_WGinZnnG)/(30469887.0*N_bin_WGinZnnG) + (0.18213-N_bin_ZnnGinZnnG)/(2040365.0*N_bin_ZnnGinZnnG));
      y_error_syst_ZNuNuGJets_ewkscale = (fabs(y_value_ZNuNuGJets_ewkscaleUp - y_value)+fabs(y_value_ZNuNuGJets_ewkscaleDown - y_value))/2.0;
      y_error_syst_ZNuNuGJets_ewkshape = (fabs(y_value_ZNuNuGJets_ewkshapeUp - y_value)+fabs(y_value_ZNuNuGJets_ewkshapeDown - y_value))/2.0;
      y_error_syst_ZNuNuGJets_gamma = (fabs(y_value_ZNuNuGJets_gammaUp - y_value)+fabs(y_value_ZNuNuGJets_gammaDown - y_value))/2.0;
      y_error_syst_WGJets_ewkscale = (fabs(y_value_WGJets_ewkscaleUp - y_value)+fabs(y_value_WGJets_ewkscaleDown - y_value))/2.0;
      y_error_syst_WGJets_ewkshape = (fabs(y_value_WGJets_ewkshapeUp - y_value)+fabs(y_value_WGJets_ewkshapeDown - y_value))/2.0;
      y_error_syst_WGJets_gamma = (fabs(y_value_WGJets_gammaUp - y_value)+fabs(y_value_WGJets_gammaDown - y_value))/2.0;
      y_error_syst_pdf = (fabs(y_value_pdfUp - y_value)+fabs(y_value_pdfDown - y_value))/2.0;
      y_error_syst_ZNuNuGJets_qcdscale = (fabs(y_value_ZNuNuGJets_qcdscaleUp - y_value)+fabs(y_value_ZNuNuGJets_qcdscaleDown - y_value))/2.0;
      y_error_syst_WGJets_qcdscale = (fabs(y_value_WGJets_qcdscaleUp - y_value)+fabs(y_value_WGJets_qcdscaleDown - y_value))/2.0;
      y_error_syst_combined = sqrt(y_error_syst_ZNuNuGJets_ewkscale*y_error_syst_ZNuNuGJets_ewkscale + y_error_syst_ZNuNuGJets_ewkshape*y_error_syst_ZNuNuGJets_ewkshape + y_error_syst_ZNuNuGJets_gamma*y_error_syst_ZNuNuGJets_gamma + y_error_syst_WGJets_ewkscale*y_error_syst_WGJets_ewkscale + y_error_syst_WGJets_ewkshape*y_error_syst_WGJets_ewkshape + y_error_syst_WGJets_gamma*y_error_syst_WGJets_gamma + y_error_syst_ZNuNuGJets_qcdscale*y_error_syst_ZNuNuGJets_qcdscale + y_error_syst_WGJets_qcdscale*y_error_syst_WGJets_qcdscale + y_error_syst_pdf*y_error_syst_pdf);
      // DEBUG
      // cout<<"fractional pdf err bin "<<i<<": "<<y_error_syst_pdf/y_value<<endl;
      // cout<<"bin="<<i<<", y_value="<<y_value<<", y_error_stat="<<y_error_stat<<", y_error_syst_combined="<<y_error_syst_combined<<endl;
      y_error_combined = sqrt(y_error_stat*y_error_stat + y_error_syst_combined*y_error_syst_combined);
    }
    transfer_factor_stat->SetPoint(i-1,x_value,y_value);
    transfer_factor_stat->SetPointError(i-1,x_halfwidth,y_error_stat);
    transfer_factor_syst->SetPoint(i-1,x_value,y_value);
    transfer_factor_syst->SetPointError(i-1,x_halfwidth,y_error_syst_combined);
    transfer_factor_combined->SetPoint(i-1,x_value,y_value);
    transfer_factor_combined->SetPointError(i-1,x_halfwidth,y_error_combined);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_noShift->SetBinContent(i,y_value);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_noShift->SetBinError(i,y_error_stat);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_ewkscale_shiftUp->SetBinContent(i,y_value_ZNuNuGJets_ewkscaleUp);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_ewkscale_shiftDown->SetBinContent(i,y_value_ZNuNuGJets_ewkscaleDown);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_ewkshape_shiftUp->SetBinContent(i,y_value_ZNuNuGJets_ewkshapeUp);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_ewkshape_shiftDown->SetBinContent(i,y_value_ZNuNuGJets_ewkshapeDown);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_gamma_shiftUp->SetBinContent(i,y_value_ZNuNuGJets_gammaUp);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_gamma_shiftDown->SetBinContent(i,y_value_ZNuNuGJets_gammaDown);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_ewkscale_shiftUp->SetBinContent(i,y_value_WGJets_ewkscaleUp);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_ewkscale_shiftDown->SetBinContent(i,y_value_WGJets_ewkscaleDown);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_ewkshape_shiftUp->SetBinContent(i,y_value_WGJets_ewkshapeUp);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_ewkshape_shiftDown->SetBinContent(i,y_value_WGJets_ewkshapeDown);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_gamma_shiftUp->SetBinContent(i,y_value_WGJets_gammaUp);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_gamma_shiftDown->SetBinContent(i,y_value_WGJets_gammaDown);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_ewkscale_shiftUp->SetBinContent(i,y_value_correlated_ewkscaleUp);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_ewkscale_shiftDown->SetBinContent(i,y_value_correlated_ewkscaleDown);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_ewkshape_shiftUp->SetBinContent(i,y_value_correlated_ewkshapeUp);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_ewkshape_shiftDown->SetBinContent(i,y_value_correlated_ewkshapeDown);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_gamma_shiftUp->SetBinContent(i,y_value_correlated_gammaUp);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_gamma_shiftDown->SetBinContent(i,y_value_correlated_gammaDown);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_ewkscale_shiftUp->SetBinContent(i,y_value_anticorrelated_ewkscaleUp);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_ewkscale_shiftDown->SetBinContent(i,y_value_anticorrelated_ewkscaleDown);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_ewkshape_shiftUp->SetBinContent(i,y_value_anticorrelated_ewkshapeUp);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_ewkshape_shiftDown->SetBinContent(i,y_value_anticorrelated_ewkshapeDown);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_gamma_shiftUp->SetBinContent(i,y_value_anticorrelated_gammaUp);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_gamma_shiftDown->SetBinContent(i,y_value_anticorrelated_gammaDown);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_pdf_shiftUp->SetBinContent(i,y_value_pdfUp);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_pdf_shiftDown->SetBinContent(i,y_value_pdfDown);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_qcdscale_shiftUp->SetBinContent(i,y_value_ZNuNuGJets_qcdscaleUp);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_qcdscale_shiftDown->SetBinContent(i,y_value_ZNuNuGJets_qcdscaleDown);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_qcdscale_shiftUp->SetBinContent(i,y_value_WGJets_qcdscaleUp);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_qcdscale_shiftDown->SetBinContent(i,y_value_WGJets_qcdscaleDown);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_qcdscale_shiftUp->SetBinContent(i,y_value_correlated_qcdscaleUp);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_qcdscale_shiftDown->SetBinContent(i,y_value_correlated_qcdscaleDown);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_qcdscale_shiftUp->SetBinContent(i,y_value_anticorrelated_qcdscaleUp);
    transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_qcdscale_shiftDown->SetBinContent(i,y_value_anticorrelated_qcdscaleDown);
    transfer_shift_noShift->SetBinContent(i,1.0);
    transfer_shift_ZNuNuGJets_ewkscale_shiftUp->SetBinContent(i,y_value_ZNuNuGJets_ewkscaleUp/y_value);
    transfer_shift_ZNuNuGJets_ewkscale_shiftDown->SetBinContent(i,y_value_ZNuNuGJets_ewkscaleDown/y_value);
    transfer_shift_ZNuNuGJets_ewkshape_shiftUp->SetBinContent(i,y_value_ZNuNuGJets_ewkshapeUp/y_value);
    transfer_shift_ZNuNuGJets_ewkshape_shiftDown->SetBinContent(i,y_value_ZNuNuGJets_ewkshapeDown/y_value);
    transfer_shift_ZNuNuGJets_gamma_shiftUp->SetBinContent(i,y_value_ZNuNuGJets_gammaUp/y_value);
    transfer_shift_ZNuNuGJets_gamma_shiftDown->SetBinContent(i,y_value_ZNuNuGJets_gammaDown/y_value);
    transfer_shift_WGJets_ewkscale_shiftUp->SetBinContent(i,y_value_WGJets_ewkscaleUp/y_value);
    transfer_shift_WGJets_ewkscale_shiftDown->SetBinContent(i,y_value_WGJets_ewkscaleDown/y_value);
    transfer_shift_WGJets_ewkshape_shiftUp->SetBinContent(i,y_value_WGJets_ewkshapeUp/y_value);
    transfer_shift_WGJets_ewkshape_shiftDown->SetBinContent(i,y_value_WGJets_ewkshapeDown/y_value);
    transfer_shift_WGJets_gamma_shiftUp->SetBinContent(i,y_value_WGJets_gammaUp/y_value);
    transfer_shift_WGJets_gamma_shiftDown->SetBinContent(i,y_value_WGJets_gammaDown/y_value);
    // Old and not as good
    // transfer_shift_ZNuNuGJets_ewkscale_shiftUp->SetBinContent(i,(y_value+y_error_syst_ewkscale)/y_value);
    // transfer_shift_ZNuNuGJets_ewkscale_shiftDown->SetBinContent(i,(y_value-y_error_syst_ewkscale)/y_value);
    // transfer_shift_ZNuNuGJets_ewkshape_shiftUp->SetBinContent(i,(y_value+y_error_syst_ewkshape)/y_value);
    // transfer_shift_ZNuNuGJets_ewkshape_shiftDown->SetBinContent(i,(y_value-y_error_syst_ewkshape)/y_value);
    // transfer_shift_ZNuNuGJets_gamma_shiftUp->SetBinContent(i,(y_value+y_error_syst_gamma)/y_value);
    // transfer_shift_ZNuNuGJets_gamma_shiftDown->SetBinContent(i,(y_value-y_error_syst_gamma)/y_value);
    transfer_shift_pdf_shiftUp->SetBinContent(i,y_value_pdfUp/y_value);
    transfer_shift_pdf_shiftDown->SetBinContent(i,y_value_pdfDown/y_value);
    transfer_shift_ZNuNuGJets_qcdscale_shiftUp->SetBinContent(i,y_value_ZNuNuGJets_qcdscaleUp/y_value);
    transfer_shift_ZNuNuGJets_qcdscale_shiftDown->SetBinContent(i,y_value_ZNuNuGJets_qcdscaleDown/y_value);
    transfer_shift_WGJets_qcdscale_shiftUp->SetBinContent(i,y_value_WGJets_qcdscaleUp/y_value);
    transfer_shift_WGJets_qcdscale_shiftDown->SetBinContent(i,y_value_WGJets_qcdscaleDown/y_value);
  }
  TGraphErrors *graph_WGinZnnG_to_ZnnGinZnnG_stat = (TGraphErrors*)transfer_factor_stat->Clone("transfer_WGinZnnG_to_ZnnGinZnnG_stat");
  TGraphErrors *graph_WGinZnnG_to_ZnnGinZnnG_syst = (TGraphErrors*)transfer_factor_syst->Clone("transfer_WGinZnnG_to_ZnnGinZnnG_syst");
  TGraphErrors *graph_WGinZnnG_to_ZnnGinZnnG_combined = (TGraphErrors*)transfer_factor_combined->Clone("transfer_WGinZnnG_to_ZnnGinZnnG");
  
  // WGinWenG_to_WGinZnnG
  transfer_factor_stat = new TGraphErrors();
  transfer_factor_syst = new TGraphErrors();
  transfer_factor_combined = new TGraphErrors();
  TH1F* transfer_factor_WGinWenG_to_WGinZnnG_noShift = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinWenG_to_WGinZnnG_noShift");
  TH1F* transfer_factor_WGinWenG_to_WGinZnnG_eleEff_shiftUp = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinWenG_to_WGinZnnG_eleEff_shiftUp");
  TH1F* transfer_factor_WGinWenG_to_WGinZnnG_eleEff_shiftDown = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinWenG_to_WGinZnnG_eleEff_shiftDown");
  for(int i = 1; i <= nBins; i++){
    Double_t x_value = histo_ZnnG_WGJets_unscaled->GetBinCenter(i);
    Double_t x_halfwidth = (histo_ZnnG_WGJets_unscaled->GetBinWidth(i))/2.0;
    Double_t y_value = 0.0;
    Double_t y_error_stat = 0.0;
    Double_t y_error_syst_eleScaleFactor = 0.0;
    Double_t y_error_syst_combined = 0.0;
    Double_t y_error_combined = 0.0;
    if(histo_ZnnG_WGJets_unscaled->GetBinContent(i) > 0.0){
      Double_t N_bin_WGinWenG = histo_WenG_WGJets_unscaled->GetBinContent(i);
      Double_t N_bin_WGinZnnG = histo_ZnnG_WGJets_unscaled->GetBinContent(i);
      y_value = N_bin_WGinZnnG / N_bin_WGinWenG;
      y_error_stat = y_value*sqrt((1.0-N_bin_WGinWenG/30469887.0)/(N_bin_WGinWenG) + (1.0-N_bin_WGinZnnG/30469887.0)/(N_bin_WGinZnnG));
      y_error_syst_eleScaleFactor = ( fabs(N_bin_WGinZnnG / (N_bin_WGinWenG*(1-scale_unc_electron)) - y_value) + fabs(y_value - N_bin_WGinZnnG / (N_bin_WGinWenG*(1+scale_unc_electron))) )/2.0;
      y_error_syst_combined = sqrt(y_error_syst_eleScaleFactor*y_error_syst_eleScaleFactor);
      y_error_combined = sqrt(y_error_stat*y_error_stat + y_error_syst_combined*y_error_syst_combined);
    }
    transfer_factor_stat->SetPoint(i-1,x_value,y_value);
    transfer_factor_stat->SetPointError(i-1,x_halfwidth,y_error_stat);
    transfer_factor_syst->SetPoint(i-1,x_value,y_value);
    transfer_factor_syst->SetPointError(i-1,x_halfwidth,y_error_syst_combined);
    transfer_factor_combined->SetPoint(i-1,x_value,y_value);
    transfer_factor_combined->SetPointError(i-1,x_halfwidth,y_error_combined);
    transfer_factor_WGinWenG_to_WGinZnnG_noShift->SetBinContent(i,y_value);
    transfer_factor_WGinWenG_to_WGinZnnG_noShift->SetBinError(i,y_error_stat);
    transfer_factor_WGinWenG_to_WGinZnnG_eleEff_shiftUp->SetBinContent(i,y_value/(1-scale_unc_electron));
    transfer_factor_WGinWenG_to_WGinZnnG_eleEff_shiftDown->SetBinContent(i,y_value/(1+scale_unc_electron));
  }
  TGraphErrors *graph_WGinWenG_to_WGinZnnG_stat = (TGraphErrors*)transfer_factor_stat->Clone("transfer_WGinWenG_to_WGinZnnG_stat");
  TGraphErrors *graph_WGinWenG_to_WGinZnnG_syst = (TGraphErrors*)transfer_factor_syst->Clone("transfer_WGinWenG_to_WGinZnnG_syst");
  TGraphErrors *graph_WGinWenG_to_WGinZnnG_combined = (TGraphErrors*)transfer_factor_combined->Clone("transfer_WGinWenG_to_WGinZnnG");
  
  // WGinWmnG_to_WGinZnnG
  transfer_factor_stat = new TGraphErrors();
  transfer_factor_syst = new TGraphErrors();
  transfer_factor_combined = new TGraphErrors();
  TH1F* transfer_factor_WGinWmnG_to_WGinZnnG_noShift = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinWmnG_to_WGinZnnG_noShift");
  TH1F* transfer_factor_WGinWmnG_to_WGinZnnG_muEff_shiftUp = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinWmnG_to_WGinZnnG_muEff_shiftUp");
  TH1F* transfer_factor_WGinWmnG_to_WGinZnnG_muEff_shiftDown = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_WGinWmnG_to_WGinZnnG_muEff_shiftDown");
  for(int i = 1; i <= nBins; i++)
  {
    Double_t x_value = histo_ZnnG_WGJets_unscaled->GetBinCenter(i);
    Double_t x_halfwidth = (histo_ZnnG_WGJets_unscaled->GetBinWidth(i))/2.0;
    Double_t y_value = 0.0;
    Double_t y_error_stat = 0.0;
    Double_t y_error_syst_muScaleFactor = 0.0;
    Double_t y_error_syst_combined = 0.0;
    Double_t y_error_combined = 0.0;
    if(histo_ZnnG_WGJets_unscaled->GetBinContent(i) > 0.0){
      Double_t N_bin_WGinWmnG = histo_WmnG_WGJets_unscaled->GetBinContent(i);
      Double_t N_bin_WGinZnnG = histo_ZnnG_WGJets_unscaled->GetBinContent(i);
      y_value = N_bin_WGinZnnG / N_bin_WGinWmnG;
      y_error_stat = y_value*sqrt((1.0-N_bin_WGinWmnG/30469887.0)/(N_bin_WGinWmnG) + (1.0-N_bin_WGinZnnG/30469887.0)/(N_bin_WGinZnnG));
      y_error_syst_muScaleFactor = ( fabs(N_bin_WGinZnnG / (N_bin_WGinWmnG*(1-scale_unc_muon)) - y_value) + fabs(y_value - N_bin_WGinZnnG / (N_bin_WGinWmnG*(1+scale_unc_muon))) )/2.0;
      y_error_syst_combined = sqrt(y_error_syst_muScaleFactor*y_error_syst_muScaleFactor);
      y_error_combined = sqrt(y_error_stat*y_error_stat + y_error_syst_combined*y_error_syst_combined);
    }
    transfer_factor_stat->SetPoint(i-1,x_value,y_value);
    transfer_factor_stat->SetPointError(i-1,x_halfwidth,y_error_stat);
    transfer_factor_syst->SetPoint(i-1,x_value,y_value);
    transfer_factor_syst->SetPointError(i-1,x_halfwidth,y_error_syst_combined);
    transfer_factor_combined->SetPoint(i-1,x_value,y_value);
    transfer_factor_combined->SetPointError(i-1,x_halfwidth,y_error_combined);
    transfer_factor_WGinWmnG_to_WGinZnnG_noShift->SetBinContent(i,y_value);
    transfer_factor_WGinWmnG_to_WGinZnnG_noShift->SetBinError(i,y_error_stat);
    transfer_factor_WGinWmnG_to_WGinZnnG_muEff_shiftUp->SetBinContent(i,y_value/(1-scale_unc_muon));
    transfer_factor_WGinWmnG_to_WGinZnnG_muEff_shiftDown->SetBinContent(i,y_value/(1+scale_unc_muon));
  }
  TGraphErrors *graph_WGinWmnG_to_WGinZnnG_stat = (TGraphErrors*)transfer_factor_stat->Clone("transfer_WGinWmnG_to_WGinZnnG_stat");
  TGraphErrors *graph_WGinWmnG_to_WGinZnnG_syst = (TGraphErrors*)transfer_factor_syst->Clone("transfer_WGinWmnG_to_WGinZnnG_syst");
  TGraphErrors *graph_WGinWmnG_to_WGinZnnG_combined = (TGraphErrors*)transfer_factor_combined->Clone("transfer_WGinWmnG_to_WGinZnnG");
  
  // ZllGinZeeG_to_ZnnGinZnnG
  transfer_factor_stat = new TGraphErrors();
  transfer_factor_syst = new TGraphErrors();
  transfer_factor_combined = new TGraphErrors();
  TH1F* transfer_factor_ZllGinZeeG_to_ZnnGinZnnG_noShift = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_ZllGinZeeG_to_ZnnGinZnnG_noShift");
  TH1F* transfer_factor_ZllGinZeeG_to_ZnnGinZnnG_eleEff_shiftUp = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_ZllGinZeeG_to_ZnnGinZnnG_eleEff_shiftUp");
  TH1F* transfer_factor_ZllGinZeeG_to_ZnnGinZnnG_eleEff_shiftDown = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_ZllGinZeeG_to_ZnnGinZnnG_eleEff_shiftDown");
  for(int i = 1; i <= nBins; i++)
  {
    Double_t x_value = histo_ZnnG_ZNuNuGJets_scaled->GetBinCenter(i);
    Double_t x_halfwidth = (histo_ZnnG_ZNuNuGJets_scaled->GetBinWidth(i))/2.0;
    Double_t y_value = 0.0;
    Double_t y_error_stat = 0.0;
    Double_t y_error_syst_eleScaleFactor = 0.0;
    Double_t y_error_syst_combined = 0.0;
    Double_t y_error_combined = 0.0;
    if(histo_ZnnG_ZNuNuGJets_scaled->GetBinContent(i) > 0.0){
      Double_t N_bin_ZllGinZeeG_130_under300 = histo_ZeeG_ZLLGJets_130_under300_scaled->GetBinContent(i);
      Double_t N_bin_ZllGinZeeG_300 = histo_ZeeG_ZLLGJets_300_scaled->GetBinContent(i);
      Double_t N_bin_ZllGinZeeG = N_bin_ZllGinZeeG_130_under300 + N_bin_ZllGinZeeG_300;
      Double_t N_bin_ZnnGinZnnG = histo_ZnnG_ZNuNuGJets_scaled->GetBinContent(i);
      y_value = N_bin_ZnnGinZnnG / N_bin_ZllGinZeeG;
      Double_t y_error_stat_squared = 0.0;
      if(N_bin_ZllGinZeeG > 0)
        y_error_stat_squared += (N_bin_ZllGinZeeG_130_under300*(0.148-N_bin_ZllGinZeeG_130_under300)/489423.0 + N_bin_ZnnGinZnnG*(0.0092-N_bin_ZllGinZeeG_300)/1707773.0) / (N_bin_ZllGinZeeG*N_bin_ZllGinZeeG);
      if(N_bin_ZnnGinZnnG > 0)
        y_error_stat_squared += (0.18213-N_bin_ZnnGinZnnG)/(329894.0*N_bin_ZnnGinZnnG);
      y_error_stat = y_value*sqrt(y_error_stat_squared);
      y_error_syst_eleScaleFactor = (fabs(N_bin_ZnnGinZnnG / (N_bin_ZllGinZeeG*(1-scale_unc_electron_squared)) - y_value) + fabs(y_value - N_bin_ZnnGinZnnG / (N_bin_ZllGinZeeG*(1+scale_unc_electron_squared))))/2.0;
      y_error_syst_combined = sqrt(y_error_syst_eleScaleFactor*y_error_syst_eleScaleFactor);
      y_error_combined = sqrt(y_error_stat*y_error_stat + y_error_syst_combined*y_error_syst_combined);
    }
    transfer_factor_stat->SetPoint(i-1,x_value,y_value);
    transfer_factor_stat->SetPointError(i-1,x_halfwidth,y_error_stat);
    transfer_factor_syst->SetPoint(i-1,x_value,y_value);
    transfer_factor_syst->SetPointError(i-1,x_halfwidth,y_error_syst_combined);
    transfer_factor_combined->SetPoint(i-1,x_value,y_value);
    transfer_factor_combined->SetPointError(i-1,x_halfwidth,y_error_combined);
    transfer_factor_ZllGinZeeG_to_ZnnGinZnnG_noShift->SetBinContent(i,y_value);
    transfer_factor_ZllGinZeeG_to_ZnnGinZnnG_noShift->SetBinError(i,y_error_stat);
    transfer_factor_ZllGinZeeG_to_ZnnGinZnnG_eleEff_shiftUp->SetBinContent(i,y_value/(1-scale_unc_electron_squared));
    transfer_factor_ZllGinZeeG_to_ZnnGinZnnG_eleEff_shiftDown->SetBinContent(i,y_value/(1+scale_unc_electron_squared));
  }
  TGraphErrors *graph_ZllGinZeeG_to_ZnnGinZnnG_stat = (TGraphErrors*)transfer_factor_stat->Clone("transfer_ZllGinZeeG_to_ZnnGinZnnG_stat");
  TGraphErrors *graph_ZllGinZeeG_to_ZnnGinZnnG_syst = (TGraphErrors*)transfer_factor_syst->Clone("transfer_ZllGinZeeG_to_ZnnGinZnnG_syst");
  TGraphErrors *graph_ZllGinZeeG_to_ZnnGinZnnG_combined = (TGraphErrors*)transfer_factor_combined->Clone("transfer_ZllGinZeeG_to_ZnnGinZnnG");
  
  // ZllGinZmmG_to_ZnnGinZnnG
  transfer_factor_stat = new TGraphErrors();
  transfer_factor_syst = new TGraphErrors();
  transfer_factor_combined = new TGraphErrors();
  TH1F* transfer_factor_ZllGinZmmG_to_ZnnGinZnnG_noShift = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_ZllGinZmmG_to_ZnnGinZnnG_noShift");
  TH1F* transfer_factor_ZllGinZmmG_to_ZnnGinZnnG_muEff_shiftUp = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_ZllGinZmmG_to_ZnnGinZnnG_muEff_shiftUp");
  TH1F* transfer_factor_ZllGinZmmG_to_ZnnGinZnnG_muEff_shiftDown = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_ZllGinZmmG_to_ZnnGinZnnG_muEff_shiftDown");
  for(int i = 1; i <= nBins; i++)
  {
    Double_t x_value = histo_ZnnG_ZNuNuGJets_scaled->GetBinCenter(i);
    Double_t x_halfwidth = (histo_ZnnG_ZNuNuGJets_scaled->GetBinWidth(i))/2.0;
    Double_t y_value = 0.0;
    Double_t y_error_stat = 0.0;
    Double_t y_error_syst_muScaleFactor = 0.0;
    Double_t y_error_syst_combined = 0.0;
    Double_t y_error_combined = 0.0;
    if(histo_ZnnG_ZNuNuGJets_scaled->GetBinContent(i) > 0.0){
      Double_t N_bin_ZllGinZmmG_130_under300 = histo_ZmmG_ZLLGJets_130_under300_scaled->GetBinContent(i);
      Double_t N_bin_ZllGinZmmG_300 = histo_ZmmG_ZLLGJets_300_scaled->GetBinContent(i);
      Double_t N_bin_ZllGinZmmG = N_bin_ZllGinZmmG_130_under300 + N_bin_ZllGinZmmG_300;
      Double_t N_bin_ZnnGinZnnG = histo_ZnnG_ZNuNuGJets_scaled->GetBinContent(i);
      y_value = N_bin_ZnnGinZnnG / N_bin_ZllGinZmmG;
      Double_t y_error_stat_squared = 0.0;
      if(N_bin_ZllGinZmmG > 0)
        y_error_stat_squared += (N_bin_ZllGinZmmG_130_under300*(0.148-N_bin_ZllGinZmmG_130_under300)/489423.0 + N_bin_ZnnGinZnnG*(0.0092-N_bin_ZllGinZmmG_300)/1707773.0) / (N_bin_ZllGinZmmG*N_bin_ZllGinZmmG);
      if(N_bin_ZnnGinZnnG > 0)
        y_error_stat_squared += (0.18213-N_bin_ZnnGinZnnG)/(329894.0*N_bin_ZnnGinZnnG);
      y_error_stat = y_value*sqrt(y_error_stat_squared);
      y_error_syst_muScaleFactor = (fabs(N_bin_ZnnGinZnnG / (N_bin_ZllGinZmmG*(1-scale_unc_muon_squared)) - y_value) + fabs(y_value - N_bin_ZnnGinZnnG / (N_bin_ZllGinZmmG*(1+scale_unc_muon_squared))))/2.0;
      y_error_syst_combined = sqrt(y_error_syst_muScaleFactor*y_error_syst_muScaleFactor);
      y_error_combined = sqrt(y_error_stat*y_error_stat + y_error_syst_combined*y_error_syst_combined);
    }
    transfer_factor_stat->SetPoint(i-1,x_value,y_value);
    transfer_factor_stat->SetPointError(i-1,x_halfwidth,y_error_stat);
    transfer_factor_syst->SetPoint(i-1,x_value,y_value);
    transfer_factor_syst->SetPointError(i-1,x_halfwidth,y_error_syst_combined);
    transfer_factor_combined->SetPoint(i-1,x_value,y_value);
    transfer_factor_combined->SetPointError(i-1,x_halfwidth,y_error_combined);
    transfer_factor_ZllGinZmmG_to_ZnnGinZnnG_noShift->SetBinContent(i,y_value);
    transfer_factor_ZllGinZmmG_to_ZnnGinZnnG_noShift->SetBinError(i,y_error_stat);
    transfer_factor_ZllGinZmmG_to_ZnnGinZnnG_muEff_shiftUp->SetBinContent(i,y_value/(1-scale_unc_muon_squared));
    transfer_factor_ZllGinZmmG_to_ZnnGinZnnG_muEff_shiftDown->SetBinContent(i,y_value/(1+scale_unc_muon_squared));
  }
  TGraphErrors *graph_ZllGinZmmG_to_ZnnGinZnnG_stat = (TGraphErrors*)transfer_factor_stat->Clone("transfer_ZllGinZmmG_to_ZnnGinZnnG_stat");
  TGraphErrors *graph_ZllGinZmmG_to_ZnnGinZnnG_syst = (TGraphErrors*)transfer_factor_syst->Clone("transfer_ZllGinZmmG_to_ZnnGinZnnG_syst");
  TGraphErrors *graph_ZllGinZmmG_to_ZnnGinZnnG_combined = (TGraphErrors*)transfer_factor_combined->Clone("transfer_ZllGinZmmG_to_ZnnGinZnnG");
  
  
  TH1F* transfer_factor_SBtoSA = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_SBtoSA");
  for(int i = 1; i <= nBins; i++){
    transfer_factor_SBtoSA->SetBinContent(i, 3.14159-1.0);
    transfer_factor_SBtoSA->SetBinError(i, 0.0);
  }
  
  TH1F* transfer_factor_SBtoSA_halo = (TH1F*)histo_ZnnG_ZNuNuGJets_scaled->Clone("transfer_factor_SBtoSA_halo");
  for(int i = 1; i <= nBins; i++){
    transfer_factor_SBtoSA_halo->SetBinContent(i, 1.992/24.067);
    transfer_factor_SBtoSA_halo->SetBinError(i, transfer_factor_SBtoSA_halo->GetBinContent(i));
  }
  
  ////////////////
  // Draw plots //
  ////////////////

  // Define variables used for drawing
  TCanvas *c = new TCanvas("c", "canvas",700,640);
  gStyle->SetOptStat(0);
  gStyle->SetLegendBorderSize(0);
  c->SetLeftMargin(0.15);
  c->SetBottomMargin(0.15);
  TLatex *texS;
  TLatex *texS1;
  TLegend* leg;
  TGaxis *xaxis;
  TGaxis *xaxis_top;
  TGaxis *yaxis;
  TGaxis *yaxis_right;
  double xmin = 0.0;
  double ymin = 0.0;
  double xmax = 0.0;
  double ymax = 0.0;
  
  // Draw Z/W shifts
  transfer_shift_noShift->SetTitle("");
  transfer_shift_noShift->GetXaxis()->SetTitle("");
  transfer_shift_noShift->GetXaxis()->SetTitle("");
  transfer_shift_noShift->GetXaxis()->SetTickLength(0);
  transfer_shift_noShift->GetXaxis()->SetLabelOffset(999);
  transfer_shift_noShift->GetXaxis()->SetRangeUser(175,1000);
  transfer_shift_noShift->GetYaxis()->SetTitle("");
  transfer_shift_noShift->GetYaxis()->SetTitle("");
  transfer_shift_noShift->GetYaxis()->SetTickLength(0);
  transfer_shift_noShift->GetYaxis()->SetLabelOffset(999);
  transfer_shift_noShift->GetYaxis()->SetRangeUser(0.8,1.4);
  // transfer_shift_noShift->GetYaxis()->SetRangeUser(0.6,1.6);
  transfer_shift_noShift->SetLineColor(kWhite);
  transfer_shift_noShift->SetLineWidth(3);
  transfer_shift_noShift->Draw("HIST");
  transfer_shift_ZNuNuGJets_qcdscale_shiftUp->SetLineColor(kRed);
  transfer_shift_ZNuNuGJets_qcdscale_shiftUp->SetLineWidth(3);
  transfer_shift_ZNuNuGJets_qcdscale_shiftUp->SetLineStyle(kDashed);
  transfer_shift_ZNuNuGJets_qcdscale_shiftUp->Draw("HIST SAME");
  transfer_shift_ZNuNuGJets_qcdscale_shiftDown->SetLineColor(kRed);
  transfer_shift_ZNuNuGJets_qcdscale_shiftDown->SetLineWidth(3);
  transfer_shift_ZNuNuGJets_qcdscale_shiftDown->Draw("HIST SAME");
  // transfer_shift_pdf_shiftUp->SetLineColor(kViolet);
  // transfer_shift_pdf_shiftUp->SetLineWidth(3);
  // transfer_shift_pdf_shiftUp->Draw("HIST SAME");
  // transfer_shift_pdf_shiftDown->SetLineColor(kViolet);
  // transfer_shift_pdf_shiftDown->SetLineWidth(3);
  // transfer_shift_pdf_shiftDown->SetLineStyle(kDashed);
  // transfer_shift_pdf_shiftDown->Draw("HIST SAME");
  transfer_shift_ZNuNuGJets_ewkscale_shiftUp->SetLineColor(kGray+1);
  transfer_shift_ZNuNuGJets_ewkscale_shiftUp->SetLineWidth(3);
  transfer_shift_ZNuNuGJets_ewkscale_shiftUp->SetLineStyle(kDashed);
  transfer_shift_ZNuNuGJets_ewkscale_shiftUp->Draw("HIST SAME");
  transfer_shift_ZNuNuGJets_ewkscale_shiftDown->SetLineColor(kGray+1);
  transfer_shift_ZNuNuGJets_ewkscale_shiftDown->SetLineWidth(3);
  transfer_shift_ZNuNuGJets_ewkscale_shiftDown->Draw("HIST SAME");
  transfer_shift_ZNuNuGJets_ewkshape_shiftUp->SetLineColor(kBlue);
  transfer_shift_ZNuNuGJets_ewkshape_shiftUp->SetLineWidth(3);
  transfer_shift_ZNuNuGJets_ewkshape_shiftUp->Draw("HIST SAME");
  transfer_shift_ZNuNuGJets_ewkshape_shiftDown->SetLineColor(kBlue);
  transfer_shift_ZNuNuGJets_ewkshape_shiftDown->SetLineWidth(3);
  transfer_shift_ZNuNuGJets_ewkshape_shiftDown->SetLineStyle(kDashed);
  transfer_shift_ZNuNuGJets_ewkshape_shiftDown->Draw("HIST SAME");
  transfer_shift_ZNuNuGJets_gamma_shiftUp->SetLineColor(kGreen);
  transfer_shift_ZNuNuGJets_gamma_shiftUp->SetLineWidth(3);
  transfer_shift_ZNuNuGJets_gamma_shiftUp->SetLineStyle(kDashed);
  transfer_shift_ZNuNuGJets_gamma_shiftUp->Draw("HIST SAME");
  transfer_shift_ZNuNuGJets_gamma_shiftDown->SetLineColor(kGreen);
  transfer_shift_ZNuNuGJets_gamma_shiftDown->SetLineWidth(3);
  transfer_shift_ZNuNuGJets_gamma_shiftDown->Draw("HIST SAME");
  texS = new TLatex(0.77023,0.907173,"13 TeV");
  texS->SetNDC();
  texS->SetTextFont(42);
  texS->SetTextSize(0.045);
  texS->Draw();
  // texS1 = new TLatex(0.188849,0.834454,"#bf{CMS} #it{Preliminary}");
  texS1 = new TLatex(0.188849,0.834454,"#bf{CMS} #it{Simulation}");
  texS1->SetNDC();
  texS1->SetTextFont(42);
  texS1->SetTextSize(0.055);
  texS1->Draw();
  leg = new TLegend(0.175458,0.602953,0.812507,0.81155);
  leg->SetNColumns(2);
  leg->SetHeader("Z(#rightarrow#nu#bar{#nu})+#gamma");
  leg->SetColumnSeparation(0.05);
  leg->AddEntry(transfer_shift_ZNuNuGJets_qcdscale_shiftUp,"QCD scale up ","L");
  leg->AddEntry(transfer_shift_ZNuNuGJets_qcdscale_shiftDown,"QCD scale down","L");
  leg->AddEntry(transfer_shift_ZNuNuGJets_ewkscale_shiftUp,"EWK scale up ","L");
  leg->AddEntry(transfer_shift_ZNuNuGJets_ewkscale_shiftDown,"EWK scale down","L");
  leg->AddEntry(transfer_shift_ZNuNuGJets_ewkshape_shiftDown,"EWK shape up ","L");
  leg->AddEntry(transfer_shift_ZNuNuGJets_ewkshape_shiftUp,"EWK shape down","L");
  leg->AddEntry(transfer_shift_ZNuNuGJets_gamma_shiftUp,"Photon up ","L");
  leg->AddEntry(transfer_shift_ZNuNuGJets_gamma_shiftDown,"Photon down","L");
  // leg->AddEntry(transfer_shift_pdf_shiftUp,"PDF","L");
  leg->SetFillColor(kWhite);
  leg->SetFillStyle(0);
  leg->SetTextSize(0.045);
  leg->Draw();
  c->Update();
  xmin = c->GetUxmin();
  ymin = c->GetUymin();
  xmax = c->GetUxmax();
  ymax = c->GetUymax();
  xaxis = new TGaxis(xmin,ymin,xmax,ymin,xmin,xmax,510);
  xaxis->SetTitle(xaxis_title_signalRegion);
  xaxis->SetLabelFont(42);
  xaxis->SetLabelSize(0.045);
  xaxis->SetTitleFont(42);
  xaxis->SetTitleSize(0.055);
  xaxis_top = new TGaxis(xmin,ymax,xmax,ymax,xmin,xmax,510,"-");
  xaxis_top->SetTitle("");
  xaxis_top->SetLabelOffset(999);
  yaxis = new TGaxis(xmin,ymin,xmin,ymax,ymin,ymax,510);
  yaxis->SetTitle("f^{ Z#gamma}_{ W#gamma} Variation / Nominal");
  yaxis->SetLabelFont(42);
  yaxis->SetLabelSize(0.045);
  yaxis->SetTitleFont(42);
  yaxis->SetTitleSize(0.055);
  yaxis->SetTitleOffset(1.2);
  yaxis_right = new TGaxis(xmax,ymin,xmax,ymax,ymin,ymax,510,"+");
  yaxis_right->SetTitle("");
  yaxis_right->SetLabelOffset(999);
  xaxis->Draw("SAME");
  xaxis_top->Draw("SAME");
  yaxis->Draw("SAME");
  yaxis_right->Draw("SAME");
  c->SaveAs(TString("syst_variations_ZnnGinZnnG_over_WGinZnnG_ZNuNuGJets_"+saveAs_suffix+".pdf"));
  c->SaveAs(TString("syst_variations_ZnnGinZnnG_over_WGinZnnG_ZNuNuGJets_"+saveAs_suffix+".png"));
  
  transfer_shift_noShift->SetTitle("");
  transfer_shift_noShift->GetXaxis()->SetTitle("");
  transfer_shift_noShift->GetXaxis()->SetTitle("");
  transfer_shift_noShift->GetXaxis()->SetTickLength(0);
  transfer_shift_noShift->GetXaxis()->SetLabelOffset(999);
  transfer_shift_noShift->GetXaxis()->SetRangeUser(175,1000);
  transfer_shift_noShift->GetYaxis()->SetTitle("");
  transfer_shift_noShift->GetYaxis()->SetTitle("");
  transfer_shift_noShift->GetYaxis()->SetTickLength(0);
  transfer_shift_noShift->GetYaxis()->SetLabelOffset(999);
  transfer_shift_noShift->GetYaxis()->SetRangeUser(0.8,1.4);
  // transfer_shift_noShift->GetYaxis()->SetRangeUser(0.6,1.6);
  transfer_shift_noShift->SetLineColor(kWhite);
  transfer_shift_noShift->SetLineWidth(3);
  transfer_shift_noShift->Draw("HIST");
  transfer_shift_WGJets_qcdscale_shiftUp->SetLineColor(kRed);
  transfer_shift_WGJets_qcdscale_shiftUp->SetLineWidth(3);
  transfer_shift_WGJets_qcdscale_shiftUp->SetLineStyle(kDashed);
  transfer_shift_WGJets_qcdscale_shiftUp->Draw("HIST SAME");
  transfer_shift_WGJets_qcdscale_shiftDown->SetLineColor(kRed);
  transfer_shift_WGJets_qcdscale_shiftDown->SetLineWidth(3);
  transfer_shift_WGJets_qcdscale_shiftDown->Draw("HIST SAME");
  // transfer_shift_pdf_shiftUp->SetLineColor(kViolet);
  // transfer_shift_pdf_shiftUp->SetLineWidth(3);
  // transfer_shift_pdf_shiftUp->Draw("HIST SAME");
  // transfer_shift_pdf_shiftDown->SetLineColor(kViolet);
  // transfer_shift_pdf_shiftDown->SetLineWidth(3);
  // transfer_shift_pdf_shiftDown->SetLineStyle(kDashed);
  // transfer_shift_pdf_shiftDown->Draw("HIST SAME");
  transfer_shift_WGJets_ewkscale_shiftUp->SetLineColor(kGray+1);
  transfer_shift_WGJets_ewkscale_shiftUp->SetLineWidth(3);
  transfer_shift_WGJets_ewkscale_shiftUp->SetLineStyle(kDashed);
  transfer_shift_WGJets_ewkscale_shiftUp->Draw("HIST SAME");
  transfer_shift_WGJets_ewkscale_shiftDown->SetLineColor(kGray+1);
  transfer_shift_WGJets_ewkscale_shiftDown->SetLineWidth(3);
  transfer_shift_WGJets_ewkscale_shiftDown->Draw("HIST SAME");
  transfer_shift_WGJets_ewkshape_shiftUp->SetLineColor(kBlue);
  transfer_shift_WGJets_ewkshape_shiftUp->SetLineWidth(3);
  transfer_shift_WGJets_ewkshape_shiftUp->Draw("HIST SAME");
  transfer_shift_WGJets_ewkshape_shiftDown->SetLineColor(kBlue);
  transfer_shift_WGJets_ewkshape_shiftDown->SetLineWidth(3);
  transfer_shift_WGJets_ewkshape_shiftDown->SetLineStyle(kDashed);
  transfer_shift_WGJets_ewkshape_shiftDown->Draw("HIST SAME");
  transfer_shift_WGJets_gamma_shiftUp->SetLineColor(kGreen);
  transfer_shift_WGJets_gamma_shiftUp->SetLineWidth(3);
  transfer_shift_WGJets_gamma_shiftUp->SetLineStyle(kDashed);
  transfer_shift_WGJets_gamma_shiftUp->Draw("HIST SAME");
  transfer_shift_WGJets_gamma_shiftDown->SetLineColor(kGreen);
  transfer_shift_WGJets_gamma_shiftDown->SetLineWidth(3);
  transfer_shift_WGJets_gamma_shiftDown->Draw("HIST SAME");
  texS = new TLatex(0.77023,0.907173,"13 TeV");
  texS->SetNDC();
  texS->SetTextFont(42);
  texS->SetTextSize(0.045);
  texS->Draw();
  // texS1 = new TLatex(0.188849,0.834454,"#bf{CMS} #it{Preliminary}");
  texS1 = new TLatex(0.188849,0.834454,"#bf{CMS} #it{Simulation}");
  texS1->SetNDC();
  texS1->SetTextFont(42);
  texS1->SetTextSize(0.055);
  texS1->Draw();
  leg = new TLegend(0.175458,0.602953,0.812507,0.81155);
  leg->SetNColumns(2);
  leg->SetHeader("W(#rightarrowl#nu)+#gamma");
  leg->SetColumnSeparation(0.05);
  leg->AddEntry(transfer_shift_WGJets_qcdscale_shiftUp,"QCD scale up ","L");
  leg->AddEntry(transfer_shift_WGJets_qcdscale_shiftDown,"QCD scale down","L");
  leg->AddEntry(transfer_shift_WGJets_ewkscale_shiftUp,"EWK scale up ","L");
  leg->AddEntry(transfer_shift_WGJets_ewkscale_shiftDown,"EWK scale down","L");
  leg->AddEntry(transfer_shift_WGJets_ewkshape_shiftDown,"EWK shape up ","L");
  leg->AddEntry(transfer_shift_WGJets_ewkshape_shiftUp,"EWK shape down","L");
  leg->AddEntry(transfer_shift_WGJets_gamma_shiftUp,"Photon up ","L");
  leg->AddEntry(transfer_shift_WGJets_gamma_shiftDown,"Photon down","L");
  // leg->AddEntry(transfer_shift_pdf_shiftUp,"PDF","L");
  leg->SetFillColor(kWhite);
  leg->SetFillStyle(0);
  leg->SetTextSize(0.045);
  leg->Draw();
  c->Update();
  xmin = c->GetUxmin();
  ymin = c->GetUymin();
  xmax = c->GetUxmax();
  ymax = c->GetUymax();
  xaxis = new TGaxis(xmin,ymin,xmax,ymin,xmin,xmax,510);
  xaxis->SetTitle(xaxis_title_signalRegion);
  xaxis->SetLabelFont(42);
  xaxis->SetLabelSize(0.045);
  xaxis->SetTitleFont(42);
  xaxis->SetTitleSize(0.055);
  xaxis_top = new TGaxis(xmin,ymax,xmax,ymax,xmin,xmax,510,"-");
  xaxis_top->SetTitle("");
  xaxis_top->SetLabelOffset(999);
  yaxis = new TGaxis(xmin,ymin,xmin,ymax,ymin,ymax,510);
  yaxis->SetTitle("f^{ Z#gamma}_{ W#gamma} Variation / Nominal");
  yaxis->SetLabelFont(42);
  yaxis->SetLabelSize(0.045);
  yaxis->SetTitleFont(42);
  yaxis->SetTitleSize(0.055);
  yaxis->SetTitleOffset(1.2);
  yaxis_right = new TGaxis(xmax,ymin,xmax,ymax,ymin,ymax,510,"+");
  yaxis_right->SetTitle("");
  yaxis_right->SetLabelOffset(999);
  xaxis->Draw("SAME");
  xaxis_top->Draw("SAME");
  yaxis->Draw("SAME");
  yaxis_right->Draw("SAME");
  c->SaveAs(TString("syst_variations_ZnnGinZnnG_over_WGinZnnG_WGJets_"+saveAs_suffix+".pdf"));
  c->SaveAs(TString("syst_variations_ZnnGinZnnG_over_WGinZnnG_WGJets_"+saveAs_suffix+".png"));

  // Draw Z/W transfer factor
  graph_WGinZnnG_to_ZnnGinZnnG_combined->SetTitle("");
  graph_WGinZnnG_to_ZnnGinZnnG_combined->GetXaxis()->SetTitle("");
  graph_WGinZnnG_to_ZnnGinZnnG_combined->GetXaxis()->SetTickLength(0);
  graph_WGinZnnG_to_ZnnGinZnnG_combined->GetXaxis()->SetLabelOffset(999);
  graph_WGinZnnG_to_ZnnGinZnnG_combined->GetXaxis()->SetRangeUser(175,1000);
  graph_WGinZnnG_to_ZnnGinZnnG_combined->GetYaxis()->SetTitle("");
  graph_WGinZnnG_to_ZnnGinZnnG_combined->GetYaxis()->SetTickLength(0);
  graph_WGinZnnG_to_ZnnGinZnnG_combined->GetYaxis()->SetLabelOffset(999);
  graph_WGinZnnG_to_ZnnGinZnnG_combined->SetFillColor(kOrange-3);
  graph_WGinZnnG_to_ZnnGinZnnG_combined->Draw("AP2");
  c->Update();
  ymax = c->GetUymax();
  ymax *= 1.8;
  graph_WGinZnnG_to_ZnnGinZnnG_combined->GetYaxis()->SetRangeUser(0,ymax);
  graph_WGinZnnG_to_ZnnGinZnnG_syst->SetTitle("");
  graph_WGinZnnG_to_ZnnGinZnnG_syst->GetXaxis()->SetTitle("");
  graph_WGinZnnG_to_ZnnGinZnnG_syst->GetXaxis()->SetTickLength(0);
  graph_WGinZnnG_to_ZnnGinZnnG_syst->GetXaxis()->SetLabelOffset(999);
  graph_WGinZnnG_to_ZnnGinZnnG_syst->GetYaxis()->SetTitle("");
  graph_WGinZnnG_to_ZnnGinZnnG_syst->GetYaxis()->SetTickLength(0);
  graph_WGinZnnG_to_ZnnGinZnnG_syst->GetYaxis()->SetLabelOffset(999);
  graph_WGinZnnG_to_ZnnGinZnnG_syst->SetFillColor(kGreen-3);
  graph_WGinZnnG_to_ZnnGinZnnG_syst->Draw("P2 SAME");
  graph_WGinZnnG_to_ZnnGinZnnG_stat->SetTitle("");
  graph_WGinZnnG_to_ZnnGinZnnG_stat->GetXaxis()->SetTitle("");
  graph_WGinZnnG_to_ZnnGinZnnG_stat->GetXaxis()->SetTickLength(0);
  graph_WGinZnnG_to_ZnnGinZnnG_stat->GetXaxis()->SetLabelOffset(999);
  graph_WGinZnnG_to_ZnnGinZnnG_stat->GetYaxis()->SetTitle("");
  graph_WGinZnnG_to_ZnnGinZnnG_stat->GetYaxis()->SetTickLength(0);
  graph_WGinZnnG_to_ZnnGinZnnG_stat->GetYaxis()->SetLabelOffset(999);
  graph_WGinZnnG_to_ZnnGinZnnG_stat->SetMarkerStyle(kFullSquare);
  graph_WGinZnnG_to_ZnnGinZnnG_stat->SetMarkerColor(kBlack);
  graph_WGinZnnG_to_ZnnGinZnnG_stat->SetLineColor(kBlack);
  graph_WGinZnnG_to_ZnnGinZnnG_stat->SetLineWidth(2);
  for(int i = 1; i <= nBins; i++){
    Double_t x_halfwidth = (histo_ZnnG_ZNuNuGJets_scaled->GetBinWidth(i))/2.0;
    graph_WGinZnnG_to_ZnnGinZnnG_stat->SetPointError(i-1,x_halfwidth,0);
  }
  graph_WGinZnnG_to_ZnnGinZnnG_stat->Draw("P SAME");
  texS = new TLatex(0.77023,0.907173,"13 TeV");
  texS->SetNDC();
  texS->SetTextFont(42);
  texS->SetTextSize(0.045);
  texS->Draw();
  // texS1 = new TLatex(0.188849,0.834454,"#bf{CMS} #it{Preliminary}");
  texS1 = new TLatex(0.188849,0.834454,"#bf{CMS} #it{Simulation}");
  texS1->SetNDC();
  texS1->SetTextFont(42);
  texS1->SetTextSize(0.055);
  texS1->Draw();
  leg = new TLegend(0.205458,0.572953,0.602507,0.79155);
  leg->AddEntry(graph_WGinZnnG_to_ZnnGinZnnG_stat,"Central value","PL");
  leg->AddEntry(graph_WGinZnnG_to_ZnnGinZnnG_syst,"Syst. unc.","F");
  leg->AddEntry(graph_WGinZnnG_to_ZnnGinZnnG_combined,"Stat.+syst. unc.","F");
  leg->SetFillColor(kWhite);
  leg->SetFillStyle(0);
  leg->SetTextSize(0.045);
  leg->Draw();
  c->Update();
  xmin = c->GetUxmin();
  ymin = c->GetUymin();
  xmax = c->GetUxmax();
  ymax = c->GetUymax();
  xaxis = new TGaxis(xmin,ymin,xmax,ymin,xmin,xmax,510);
  xaxis->SetTitle(xaxis_title_signalRegion);
  xaxis->SetLabelFont(42);
  xaxis->SetLabelSize(0.045);
  xaxis->SetTitleFont(42);
  xaxis->SetTitleSize(0.055);
  xaxis_top = new TGaxis(xmin,ymax,xmax,ymax,xmin,xmax,510,"-");
  xaxis_top->SetTitle("");
  xaxis_top->SetLabelOffset(999);
  yaxis = new TGaxis(xmin,ymin,xmin,ymax,ymin,ymax,510);
  yaxis->SetTitle("f^{ Z#gamma}_{ W#gamma}");
  yaxis->SetLabelFont(42);
  yaxis->SetLabelSize(0.045);
  yaxis->SetTitleFont(42);
  yaxis->SetTitleSize(0.055);
  yaxis->SetTitleOffset(1.2);
  yaxis_right = new TGaxis(xmax,ymin,xmax,ymax,ymin,ymax,510,"+");
  yaxis_right->SetTitle("");
  yaxis_right->SetLabelOffset(999);
  xaxis->Draw("SAME");
  xaxis_top->Draw("SAME");
  yaxis->Draw("SAME");
  yaxis_right->Draw("SAME");
  c->SaveAs(TString("transfer_ZnnGinZnnG_over_WGinZnnG_"+saveAs_suffix+".pdf"));
  c->SaveAs(TString("transfer_ZnnGinZnnG_over_WGinZnnG_"+saveAs_suffix+".png"));
  
  // Draw WenG transfer factor
  graph_WGinWenG_to_WGinZnnG_combined->SetTitle("");
  graph_WGinWenG_to_WGinZnnG_combined->GetXaxis()->SetTitle("");
  graph_WGinWenG_to_WGinZnnG_combined->GetXaxis()->SetTickLength(0);
  graph_WGinWenG_to_WGinZnnG_combined->GetXaxis()->SetLabelOffset(999);
  graph_WGinWenG_to_WGinZnnG_combined->GetXaxis()->SetRangeUser(175,1000);
  graph_WGinWenG_to_WGinZnnG_combined->GetYaxis()->SetTitle("");
  graph_WGinWenG_to_WGinZnnG_combined->GetYaxis()->SetTickLength(0);
  graph_WGinWenG_to_WGinZnnG_combined->GetYaxis()->SetLabelOffset(999);
  graph_WGinWenG_to_WGinZnnG_combined->SetFillColor(kOrange-3);
  graph_WGinWenG_to_WGinZnnG_combined->Draw("AP2");
  c->Update();
  ymax = c->GetUymax();
  ymax *= 1.5;
  graph_WGinWenG_to_WGinZnnG_combined->GetYaxis()->SetRangeUser(0,ymax);
  graph_WGinWenG_to_WGinZnnG_syst->SetTitle("");
  graph_WGinWenG_to_WGinZnnG_syst->GetXaxis()->SetTitle("");
  graph_WGinWenG_to_WGinZnnG_syst->GetXaxis()->SetTickLength(0);
  graph_WGinWenG_to_WGinZnnG_syst->GetXaxis()->SetLabelOffset(999);
  graph_WGinWenG_to_WGinZnnG_syst->GetYaxis()->SetTitle("");
  graph_WGinWenG_to_WGinZnnG_syst->GetYaxis()->SetTickLength(0);
  graph_WGinWenG_to_WGinZnnG_syst->GetYaxis()->SetLabelOffset(999);
  graph_WGinWenG_to_WGinZnnG_syst->SetFillColor(kGreen-3);
  graph_WGinWenG_to_WGinZnnG_syst->Draw("P2 SAME");
  graph_WGinWenG_to_WGinZnnG_stat->SetTitle("");
  graph_WGinWenG_to_WGinZnnG_stat->GetXaxis()->SetTitle("");
  graph_WGinWenG_to_WGinZnnG_stat->GetXaxis()->SetTickLength(0);
  graph_WGinWenG_to_WGinZnnG_stat->GetXaxis()->SetLabelOffset(999);
  graph_WGinWenG_to_WGinZnnG_stat->GetYaxis()->SetTitle("");
  graph_WGinWenG_to_WGinZnnG_stat->GetYaxis()->SetTickLength(0);
  graph_WGinWenG_to_WGinZnnG_stat->GetYaxis()->SetLabelOffset(999);
  graph_WGinWenG_to_WGinZnnG_stat->SetMarkerStyle(kFullSquare);
  graph_WGinWenG_to_WGinZnnG_stat->SetMarkerColor(kBlack);
  graph_WGinWenG_to_WGinZnnG_stat->SetLineColor(kBlack);
  graph_WGinWenG_to_WGinZnnG_stat->SetLineWidth(2);
  for(int i = 1; i <= nBins; i++){
    Double_t x_halfwidth = (histo_ZnnG_ZNuNuGJets_scaled->GetBinWidth(i))/2.0;
    graph_WGinWenG_to_WGinZnnG_stat->SetPointError(i-1,x_halfwidth,0);
  }
  graph_WGinWenG_to_WGinZnnG_stat->Draw("P SAME");
  texS = new TLatex(0.77023,0.907173,"13 TeV");
  texS->SetNDC();
  texS->SetTextFont(42);
  texS->SetTextSize(0.045);
  texS->Draw();
  // texS1 = new TLatex(0.188849,0.834454,"#bf{CMS} #it{Preliminary}");
  texS1 = new TLatex(0.188849,0.834454,"#bf{CMS} #it{Simulation}");
  texS1->SetNDC();
  texS1->SetTextFont(42);
  texS1->SetTextSize(0.055);
  texS1->Draw();
  leg = new TLegend(0.395458,0.552953,0.792507,0.77155);
  leg->AddEntry(graph_WGinWenG_to_WGinZnnG_stat,"Central value","PL");
  leg->AddEntry(graph_WGinWenG_to_WGinZnnG_syst,"Syst. unc.","F");
  leg->AddEntry(graph_WGinWenG_to_WGinZnnG_combined,"Stat.+syst. unc.","F");
  leg->SetFillColor(kWhite);
  leg->SetFillStyle(0);
  leg->SetTextSize(0.045);
  leg->Draw();
  c->Update();
  xmin = c->GetUxmin();
  ymin = c->GetUymin();
  xmax = c->GetUxmax();
  ymax = c->GetUymax();
  xaxis = new TGaxis(xmin,ymin,xmax,ymin,xmin,xmax,510);
  xaxis->SetTitle(xaxis_title_nonSignalRegion);
  xaxis->SetLabelFont(42);
  xaxis->SetLabelSize(0.045);
  xaxis->SetTitleFont(42);
  xaxis->SetTitleSize(0.055);
  xaxis_top = new TGaxis(xmin,ymax,xmax,ymax,xmin,xmax,510,"-");
  xaxis_top->SetTitle("");
  xaxis_top->SetLabelOffset(999);
  yaxis = new TGaxis(xmin,ymin,xmin,ymax,ymin,ymax,510);
  yaxis->SetTitle("R^{ W#gamma}_{ e#gamma}");
  yaxis->SetLabelFont(42);
  yaxis->SetLabelSize(0.045);
  yaxis->SetTitleFont(42);
  yaxis->SetTitleSize(0.055);
  yaxis->SetTitleOffset(1.2);
  yaxis_right = new TGaxis(xmax,ymin,xmax,ymax,ymin,ymax,510,"+");
  yaxis_right->SetTitle("");
  yaxis_right->SetLabelOffset(999);
  xaxis->Draw("SAME");
  xaxis_top->Draw("SAME");
  yaxis->Draw("SAME");
  yaxis_right->Draw("SAME");
  c->SaveAs(TString("transfer_WGinZnnG_over_WGinWenG_"+saveAs_suffix+".pdf"));
  c->SaveAs(TString("transfer_WGinZnnG_over_WGinWenG_"+saveAs_suffix+".png"));
  
  // Draw WmnG transfer factor
  graph_WGinWmnG_to_WGinZnnG_combined->SetTitle("");
  graph_WGinWmnG_to_WGinZnnG_combined->GetXaxis()->SetTitle("");
  graph_WGinWmnG_to_WGinZnnG_combined->GetXaxis()->SetTickLength(0);
  graph_WGinWmnG_to_WGinZnnG_combined->GetXaxis()->SetLabelOffset(999);
  graph_WGinWmnG_to_WGinZnnG_combined->GetXaxis()->SetRangeUser(175,1000);
  graph_WGinWmnG_to_WGinZnnG_combined->GetYaxis()->SetTitle("");
  graph_WGinWmnG_to_WGinZnnG_combined->GetYaxis()->SetTickLength(0);
  graph_WGinWmnG_to_WGinZnnG_combined->GetYaxis()->SetLabelOffset(999);
  graph_WGinWmnG_to_WGinZnnG_combined->SetFillColor(kOrange-3);
  graph_WGinWmnG_to_WGinZnnG_combined->Draw("AP2");
  c->Update();
  ymax = c->GetUymax();
  ymax *= 1.5;
  graph_WGinWmnG_to_WGinZnnG_combined->GetYaxis()->SetRangeUser(0,ymax);
  graph_WGinWmnG_to_WGinZnnG_syst->SetTitle("");
  graph_WGinWmnG_to_WGinZnnG_syst->GetXaxis()->SetTitle("");
  graph_WGinWmnG_to_WGinZnnG_syst->GetXaxis()->SetTickLength(0);
  graph_WGinWmnG_to_WGinZnnG_syst->GetXaxis()->SetLabelOffset(999);
  graph_WGinWmnG_to_WGinZnnG_syst->GetYaxis()->SetTitle("");
  graph_WGinWmnG_to_WGinZnnG_syst->GetYaxis()->SetTickLength(0);
  graph_WGinWmnG_to_WGinZnnG_syst->GetYaxis()->SetLabelOffset(999);
  graph_WGinWmnG_to_WGinZnnG_syst->SetFillColor(kGreen-3);
  graph_WGinWmnG_to_WGinZnnG_syst->Draw("P2 SAME");
  graph_WGinWmnG_to_WGinZnnG_stat->SetTitle("");
  graph_WGinWmnG_to_WGinZnnG_stat->GetXaxis()->SetTitle("");
  graph_WGinWmnG_to_WGinZnnG_stat->GetXaxis()->SetTickLength(0);
  graph_WGinWmnG_to_WGinZnnG_stat->GetXaxis()->SetLabelOffset(999);
  graph_WGinWmnG_to_WGinZnnG_stat->GetYaxis()->SetTitle("");
  graph_WGinWmnG_to_WGinZnnG_stat->GetYaxis()->SetTickLength(0);
  graph_WGinWmnG_to_WGinZnnG_stat->GetYaxis()->SetLabelOffset(999);
  graph_WGinWmnG_to_WGinZnnG_stat->SetMarkerStyle(kFullSquare);
  graph_WGinWmnG_to_WGinZnnG_stat->SetMarkerColor(kBlack);
  graph_WGinWmnG_to_WGinZnnG_stat->SetLineColor(kBlack);
  graph_WGinWmnG_to_WGinZnnG_stat->SetLineWidth(2);
  for(int i = 1; i <= nBins; i++){
    Double_t x_halfwidth = (histo_ZnnG_ZNuNuGJets_scaled->GetBinWidth(i))/2.0;
    graph_WGinWmnG_to_WGinZnnG_stat->SetPointError(i-1,x_halfwidth,0);
  }
  graph_WGinWmnG_to_WGinZnnG_stat->Draw("P SAME");
  texS = new TLatex(0.77023,0.907173,"13 TeV");
  texS->SetNDC();
  texS->SetTextFont(42);
  texS->SetTextSize(0.045);
  texS->Draw();
  // texS1 = new TLatex(0.188849,0.834454,"#bf{CMS} #it{Preliminary}");
  texS1 = new TLatex(0.188849,0.834454,"#bf{CMS} #it{Simulation}");
  texS1->SetNDC();
  texS1->SetTextFont(42);
  texS1->SetTextSize(0.055);
  texS1->Draw();
  leg = new TLegend(0.395458,0.552953,0.792507,0.77155);
  leg->AddEntry(graph_WGinWmnG_to_WGinZnnG_stat,"Central value","PL");
  leg->AddEntry(graph_WGinWmnG_to_WGinZnnG_syst,"Syst. unc.","F");
  leg->AddEntry(graph_WGinWmnG_to_WGinZnnG_combined,"Stat.+syst. unc.","F");
  leg->SetFillColor(kWhite);
  leg->SetFillStyle(0);
  leg->SetTextSize(0.045);
  leg->Draw();
  c->Update();
  xmin = c->GetUxmin();
  ymin = c->GetUymin();
  xmax = c->GetUxmax();
  ymax = c->GetUymax();
  xaxis = new TGaxis(xmin,ymin,xmax,ymin,xmin,xmax,510);
  xaxis->SetTitle(xaxis_title_nonSignalRegion);
  xaxis->SetLabelFont(42);
  xaxis->SetLabelSize(0.045);
  xaxis->SetTitleFont(42);
  xaxis->SetTitleSize(0.055);
  xaxis_top = new TGaxis(xmin,ymax,xmax,ymax,xmin,xmax,510,"-");
  xaxis_top->SetTitle("");
  xaxis_top->SetLabelOffset(999);
  yaxis = new TGaxis(xmin,ymin,xmin,ymax,ymin,ymax,510);
  yaxis->SetTitle("R^{ W#gamma}_{ #mu#gamma}");
  yaxis->SetLabelFont(42);
  yaxis->SetLabelSize(0.045);
  yaxis->SetTitleFont(42);
  yaxis->SetTitleSize(0.055);
  yaxis->SetTitleOffset(1.2);
  yaxis_right = new TGaxis(xmax,ymin,xmax,ymax,ymin,ymax,510,"+");
  yaxis_right->SetTitle("");
  yaxis_right->SetLabelOffset(999);
  xaxis->Draw("SAME");
  xaxis_top->Draw("SAME");
  yaxis->Draw("SAME");
  yaxis_right->Draw("SAME");
  c->SaveAs(TString("transfer_WGinZnnG_over_WGinWmnG_"+saveAs_suffix+".pdf"));
  c->SaveAs(TString("transfer_WGinZnnG_over_WGinWmnG_"+saveAs_suffix+".png"));
  
  // Draw ZeeG transfer factor
  graph_ZllGinZeeG_to_ZnnGinZnnG_combined->SetTitle("");
  graph_ZllGinZeeG_to_ZnnGinZnnG_combined->GetXaxis()->SetTitle("");
  graph_ZllGinZeeG_to_ZnnGinZnnG_combined->GetXaxis()->SetTickLength(0);
  graph_ZllGinZeeG_to_ZnnGinZnnG_combined->GetXaxis()->SetLabelOffset(999);
  graph_ZllGinZeeG_to_ZnnGinZnnG_combined->GetXaxis()->SetRangeUser(175,1000);
  graph_ZllGinZeeG_to_ZnnGinZnnG_combined->GetYaxis()->SetTitle("");
  graph_ZllGinZeeG_to_ZnnGinZnnG_combined->GetYaxis()->SetTickLength(0);
  graph_ZllGinZeeG_to_ZnnGinZnnG_combined->GetYaxis()->SetLabelOffset(999);
  graph_ZllGinZeeG_to_ZnnGinZnnG_combined->SetFillColor(kOrange-3);
  graph_ZllGinZeeG_to_ZnnGinZnnG_combined->Draw("AP2");
  c->Update();
  ymax = c->GetUymax();
  ymax *= 1.6;
  graph_ZllGinZeeG_to_ZnnGinZnnG_combined->GetYaxis()->SetRangeUser(0,ymax);
  graph_ZllGinZeeG_to_ZnnGinZnnG_syst->SetTitle("");
  graph_ZllGinZeeG_to_ZnnGinZnnG_syst->GetXaxis()->SetTitle("");
  graph_ZllGinZeeG_to_ZnnGinZnnG_syst->GetXaxis()->SetTickLength(0);
  graph_ZllGinZeeG_to_ZnnGinZnnG_syst->GetXaxis()->SetLabelOffset(999);
  graph_ZllGinZeeG_to_ZnnGinZnnG_syst->GetYaxis()->SetTitle("");
  graph_ZllGinZeeG_to_ZnnGinZnnG_syst->GetYaxis()->SetTickLength(0);
  graph_ZllGinZeeG_to_ZnnGinZnnG_syst->GetYaxis()->SetLabelOffset(999);
  graph_ZllGinZeeG_to_ZnnGinZnnG_syst->SetFillColor(kGreen-3);
  graph_ZllGinZeeG_to_ZnnGinZnnG_syst->Draw("P2 SAME");
  graph_ZllGinZeeG_to_ZnnGinZnnG_stat->SetMarkerStyle(kFullSquare);
  graph_ZllGinZeeG_to_ZnnGinZnnG_stat->SetMarkerColor(kBlack);
  graph_ZllGinZeeG_to_ZnnGinZnnG_stat->SetLineColor(kBlack);
  graph_ZllGinZeeG_to_ZnnGinZnnG_stat->SetLineWidth(2);
  graph_ZllGinZeeG_to_ZnnGinZnnG_stat->SetTitle("");
  graph_ZllGinZeeG_to_ZnnGinZnnG_stat->GetXaxis()->SetTitle("");
  graph_ZllGinZeeG_to_ZnnGinZnnG_stat->GetXaxis()->SetTickLength(0);
  graph_ZllGinZeeG_to_ZnnGinZnnG_stat->GetXaxis()->SetLabelOffset(999);
  graph_ZllGinZeeG_to_ZnnGinZnnG_stat->GetYaxis()->SetTitle("");
  graph_ZllGinZeeG_to_ZnnGinZnnG_stat->GetYaxis()->SetTickLength(0);
  graph_ZllGinZeeG_to_ZnnGinZnnG_stat->GetYaxis()->SetLabelOffset(999);
  for(int i = 1; i <= nBins; i++){
    Double_t x_halfwidth = (histo_ZnnG_ZNuNuGJets_scaled->GetBinWidth(i))/2.0;
    graph_ZllGinZeeG_to_ZnnGinZnnG_stat->SetPointError(i-1,x_halfwidth,0);
  }
  graph_ZllGinZeeG_to_ZnnGinZnnG_stat->Draw("P SAME");
  texS = new TLatex(0.77023,0.907173,"13 TeV");
  texS->SetNDC();
  texS->SetTextFont(42);
  texS->SetTextSize(0.045);
  texS->Draw();
  // texS1 = new TLatex(0.188849,0.834454,"#bf{CMS} #it{Preliminary}");
  texS1 = new TLatex(0.188849,0.834454,"#bf{CMS} #it{Simulation}");
  texS1->SetNDC();
  texS1->SetTextFont(42);
  texS1->SetTextSize(0.055);
  texS1->Draw();
  leg = new TLegend(0.395458,0.552953,0.792507,0.77155);
  leg->AddEntry(graph_ZllGinZeeG_to_ZnnGinZnnG_stat,"Central value","PL");
  leg->AddEntry(graph_ZllGinZeeG_to_ZnnGinZnnG_syst,"Syst. unc.","F");
  leg->AddEntry(graph_ZllGinZeeG_to_ZnnGinZnnG_combined,"Stat.+syst. unc.","F");
  leg->SetFillColor(kWhite);
  leg->SetFillStyle(0);
  leg->SetTextSize(0.045);
  leg->Draw();
  c->Update();
  xmin = c->GetUxmin();
  ymin = c->GetUymin();
  xmax = c->GetUxmax();
  ymax = c->GetUymax();
  xaxis = new TGaxis(xmin,ymin,xmax,ymin,xmin,xmax,510);
  xaxis->SetTitle(xaxis_title_nonSignalRegion);
  xaxis->SetLabelFont(42);
  xaxis->SetLabelSize(0.045);
  xaxis->SetTitleFont(42);
  xaxis->SetTitleSize(0.055);
  xaxis_top = new TGaxis(xmin,ymax,xmax,ymax,xmin,xmax,510,"-");
  xaxis_top->SetTitle("");
  xaxis_top->SetLabelOffset(999);
  yaxis = new TGaxis(xmin,ymin,xmin,ymax,ymin,ymax,510);
  yaxis->SetTitle("R^{ Z#gamma}_{ ee#gamma}");
  yaxis->SetLabelFont(42);
  yaxis->SetLabelSize(0.045);
  yaxis->SetTitleFont(42);
  yaxis->SetTitleSize(0.055);
  yaxis->SetTitleOffset(1.2);
  yaxis_right = new TGaxis(xmax,ymin,xmax,ymax,ymin,ymax,510,"+");
  yaxis_right->SetTitle("");
  yaxis_right->SetLabelOffset(999);
  xaxis->Draw("SAME");
  xaxis_top->Draw("SAME");
  yaxis->Draw("SAME");
  yaxis_right->Draw("SAME");
  c->SaveAs(TString("transfer_ZnnGinZnnG_over_ZllGinZeeG_"+saveAs_suffix+".pdf"));
  c->SaveAs(TString("transfer_ZnnGinZnnG_over_ZllGinZeeG_"+saveAs_suffix+".png"));
  
  // Draw ZmmG transfer factor
  graph_ZllGinZmmG_to_ZnnGinZnnG_combined->SetTitle("");
  graph_ZllGinZmmG_to_ZnnGinZnnG_combined->GetXaxis()->SetTitle("");
  graph_ZllGinZmmG_to_ZnnGinZnnG_combined->GetXaxis()->SetTickLength(0);
  graph_ZllGinZmmG_to_ZnnGinZnnG_combined->GetXaxis()->SetLabelOffset(999);
  graph_ZllGinZmmG_to_ZnnGinZnnG_combined->GetXaxis()->SetRangeUser(175,1000);
  graph_ZllGinZmmG_to_ZnnGinZnnG_combined->GetYaxis()->SetTitle("");
  graph_ZllGinZmmG_to_ZnnGinZnnG_combined->GetYaxis()->SetTickLength(0);
  graph_ZllGinZmmG_to_ZnnGinZnnG_combined->GetYaxis()->SetLabelOffset(999);
  graph_ZllGinZmmG_to_ZnnGinZnnG_combined->SetFillColor(kOrange-3);
  graph_ZllGinZmmG_to_ZnnGinZnnG_combined->Draw("AP2");
  c->Update();
  ymax = c->GetUymax();
  ymax *= 1.6;
  graph_ZllGinZmmG_to_ZnnGinZnnG_combined->GetYaxis()->SetRangeUser(0,ymax);
  graph_ZllGinZmmG_to_ZnnGinZnnG_combined->Draw("AP2");
  graph_ZllGinZmmG_to_ZnnGinZnnG_syst->SetTitle("");
  graph_ZllGinZmmG_to_ZnnGinZnnG_syst->GetXaxis()->SetTitle("");
  graph_ZllGinZmmG_to_ZnnGinZnnG_syst->GetXaxis()->SetTickLength(0);
  graph_ZllGinZmmG_to_ZnnGinZnnG_syst->GetXaxis()->SetLabelOffset(999);
  graph_ZllGinZmmG_to_ZnnGinZnnG_syst->GetYaxis()->SetTitle("");
  graph_ZllGinZmmG_to_ZnnGinZnnG_syst->GetYaxis()->SetTickLength(0);
  graph_ZllGinZmmG_to_ZnnGinZnnG_syst->GetYaxis()->SetLabelOffset(999);
  graph_ZllGinZmmG_to_ZnnGinZnnG_syst->SetFillColor(kGreen-3);
  graph_ZllGinZmmG_to_ZnnGinZnnG_syst->Draw("P2 SAME");
  graph_ZllGinZmmG_to_ZnnGinZnnG_stat->SetMarkerStyle(kFullSquare);
  graph_ZllGinZmmG_to_ZnnGinZnnG_stat->SetMarkerColor(kBlack);
  graph_ZllGinZmmG_to_ZnnGinZnnG_stat->SetLineColor(kBlack);
  graph_ZllGinZmmG_to_ZnnGinZnnG_stat->SetLineWidth(2);
  graph_ZllGinZmmG_to_ZnnGinZnnG_stat->SetTitle("");
  graph_ZllGinZmmG_to_ZnnGinZnnG_stat->GetXaxis()->SetTitle("");
  graph_ZllGinZmmG_to_ZnnGinZnnG_stat->GetXaxis()->SetTickLength(0);
  graph_ZllGinZmmG_to_ZnnGinZnnG_stat->GetXaxis()->SetLabelOffset(999);
  graph_ZllGinZmmG_to_ZnnGinZnnG_stat->GetYaxis()->SetTitle("");
  graph_ZllGinZmmG_to_ZnnGinZnnG_stat->GetYaxis()->SetTickLength(0);
  graph_ZllGinZmmG_to_ZnnGinZnnG_stat->GetYaxis()->SetLabelOffset(999);
  for(int i = 1; i <= nBins; i++){
    Double_t x_halfwidth = (histo_ZnnG_ZNuNuGJets_scaled->GetBinWidth(i))/2.0;
    graph_ZllGinZmmG_to_ZnnGinZnnG_stat->SetPointError(i-1,x_halfwidth,0);
  }
  graph_ZllGinZmmG_to_ZnnGinZnnG_stat->Draw("P SAME");
  texS = new TLatex(0.77023,0.907173,"13 TeV");
  texS->SetNDC();
  texS->SetTextFont(42);
  texS->SetTextSize(0.045);
  texS->Draw();
  // texS1 = new TLatex(0.188849,0.834454,"#bf{CMS} #it{Preliminary}");
  texS1 = new TLatex(0.188849,0.834454,"#bf{CMS} #it{Simulation}");
  texS1->SetNDC();
  texS1->SetTextFont(42);
  texS1->SetTextSize(0.055);
  texS1->Draw();
  leg = new TLegend(0.395458,0.552953,0.792507,0.77155);
  leg->AddEntry(graph_ZllGinZmmG_to_ZnnGinZnnG_stat,"Central value","PL");
  leg->AddEntry(graph_ZllGinZmmG_to_ZnnGinZnnG_syst,"Syst. unc.","F");
  leg->AddEntry(graph_ZllGinZmmG_to_ZnnGinZnnG_combined,"Stat.+syst. unc.","F");
  leg->SetFillColor(kWhite);
  leg->SetFillStyle(0);
  leg->SetTextSize(0.045);
  leg->Draw();
  c->Update();
  xmin = c->GetUxmin();
  ymin = c->GetUymin();
  xmax = c->GetUxmax();
  ymax = c->GetUymax();
  xaxis = new TGaxis(xmin,ymin,xmax,ymin,xmin,xmax,510);
  xaxis->SetTitle(xaxis_title_nonSignalRegion);
  xaxis->SetLabelFont(42);
  xaxis->SetLabelSize(0.045);
  xaxis->SetTitleFont(42);
  xaxis->SetTitleSize(0.055);
  xaxis_top = new TGaxis(xmin,ymax,xmax,ymax,xmin,xmax,510,"-");
  xaxis_top->SetTitle("");
  xaxis_top->SetLabelOffset(999);
  yaxis = new TGaxis(xmin,ymin,xmin,ymax,ymin,ymax,510);
  yaxis->SetTitle("R^{ Z#gamma}_{ #mu#mu#gamma}");
  yaxis->SetLabelFont(42);
  yaxis->SetLabelSize(0.045);
  yaxis->SetTitleFont(42);
  yaxis->SetTitleSize(0.055);
  yaxis->SetTitleOffset(1.2);
  yaxis_right = new TGaxis(xmax,ymin,xmax,ymax,ymin,ymax,510,"+");
  yaxis_right->SetTitle("");
  yaxis_right->SetLabelOffset(999);
  xaxis->Draw("SAME");
  xaxis_top->Draw("SAME");
  yaxis->Draw("SAME");
  yaxis_right->Draw("SAME");
  c->SaveAs(TString("transfer_ZnnGinZnnG_over_ZllGinZmmG_"+saveAs_suffix+".pdf"));
  c->SaveAs(TString("transfer_ZnnGinZnnG_over_ZllGinZmmG_"+saveAs_suffix+".png"));
  
  
  // Write histos for combine cards
  TFile *rootfile = new TFile(TString("transfer_factors_"+xaxis_variable+".root"),"RECREATE");
  rootfile->cd();
  
  // WGinZnnG_to_ZnnGinZnnG
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_noShift = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_noShift->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_noShift");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_noShift->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_ZNuNuGJets_qcdscale_shiftUp = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_qcdscale_shiftUp->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_ZNuNuGJets_qcdscale_shiftUp");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_ZNuNuGJets_qcdscale_shiftUp->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_ZNuNuGJets_qcdscale_shiftDown = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_qcdscale_shiftDown->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_ZNuNuGJets_qcdscale_shiftDown");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_ZNuNuGJets_qcdscale_shiftDown->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_ZNuNuGJets_ewkscale_shiftUp = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_ewkscale_shiftUp->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_ZNuNuGJets_ewkscale_shiftUp");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_ZNuNuGJets_ewkscale_shiftUp->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_ZNuNuGJets_ewkscale_shiftDown = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_ewkscale_shiftDown->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_ZNuNuGJets_ewkscale_shiftDown");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_ZNuNuGJets_ewkscale_shiftDown->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_ZNuNuGJets_ewkshape_shiftUp = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_ewkshape_shiftUp->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_ZNuNuGJets_ewkshape_shiftUp");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_ZNuNuGJets_ewkshape_shiftUp->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_ZNuNuGJets_ewkshape_shiftDown = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_ewkshape_shiftDown->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_ZNuNuGJets_ewkshape_shiftDown");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_ZNuNuGJets_ewkshape_shiftDown->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_ZNuNuGJets_gamma_shiftUp = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_gamma_shiftUp->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_ZNuNuGJets_gamma_shiftUp");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_ZNuNuGJets_gamma_shiftUp->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_ZNuNuGJets_gamma_shiftDown = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_ZNuNuGJets_gamma_shiftDown->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_ZNuNuGJets_gamma_shiftDown");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_ZNuNuGJets_gamma_shiftDown->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_WGJets_qcdscale_shiftUp = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_qcdscale_shiftUp->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_WGJets_qcdscale_shiftUp");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_WGJets_qcdscale_shiftUp->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_WGJets_qcdscale_shiftDown = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_qcdscale_shiftDown->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_WGJets_qcdscale_shiftDown");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_WGJets_qcdscale_shiftDown->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_WGJets_ewkscale_shiftUp = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_ewkscale_shiftUp->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_WGJets_ewkscale_shiftUp");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_WGJets_ewkscale_shiftUp->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_WGJets_ewkscale_shiftDown = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_ewkscale_shiftDown->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_WGJets_ewkscale_shiftDown");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_WGJets_ewkscale_shiftDown->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_WGJets_ewkshape_shiftUp = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_ewkshape_shiftUp->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_WGJets_ewkshape_shiftUp");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_WGJets_ewkshape_shiftUp->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_WGJets_ewkshape_shiftDown = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_ewkshape_shiftDown->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_WGJets_ewkshape_shiftDown");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_WGJets_ewkshape_shiftDown->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_WGJets_gamma_shiftUp = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_gamma_shiftUp->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_WGJets_gamma_shiftUp");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_WGJets_gamma_shiftUp->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_WGJets_gamma_shiftDown = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_WGJets_gamma_shiftDown->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_WGJets_gamma_shiftDown");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_WGJets_gamma_shiftDown->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_correlated_qcdscale_shiftUp = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_qcdscale_shiftUp->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_correlated_qcdscale_shiftUp");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_correlated_qcdscale_shiftUp->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_correlated_qcdscale_shiftDown = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_qcdscale_shiftDown->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_correlated_qcdscale_shiftDown");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_correlated_qcdscale_shiftDown->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_correlated_ewkscale_shiftUp = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_ewkscale_shiftUp->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_correlated_ewkscale_shiftUp");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_correlated_ewkscale_shiftUp->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_correlated_ewkscale_shiftDown = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_ewkscale_shiftDown->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_correlated_ewkscale_shiftDown");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_correlated_ewkscale_shiftDown->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_correlated_ewkshape_shiftUp = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_ewkshape_shiftUp->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_correlated_ewkshape_shiftUp");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_correlated_ewkshape_shiftUp->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_correlated_ewkshape_shiftDown = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_ewkshape_shiftDown->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_correlated_ewkshape_shiftDown");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_correlated_ewkshape_shiftDown->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_correlated_gamma_shiftUp = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_gamma_shiftUp->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_correlated_gamma_shiftUp");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_correlated_gamma_shiftUp->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_correlated_gamma_shiftDown = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_correlated_gamma_shiftDown->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_correlated_gamma_shiftDown");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_correlated_gamma_shiftDown->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_anticorrelated_qcdscale_shiftUp = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_qcdscale_shiftUp->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_anticorrelated_qcdscale_shiftUp");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_anticorrelated_qcdscale_shiftUp->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_anticorrelated_qcdscale_shiftDown = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_qcdscale_shiftDown->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_anticorrelated_qcdscale_shiftDown");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_anticorrelated_qcdscale_shiftDown->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_anticorrelated_ewkscale_shiftUp = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_ewkscale_shiftUp->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_anticorrelated_ewkscale_shiftUp");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_anticorrelated_ewkscale_shiftUp->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_anticorrelated_ewkscale_shiftDown = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_ewkscale_shiftDown->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_anticorrelated_ewkscale_shiftDown");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_anticorrelated_ewkscale_shiftDown->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_anticorrelated_ewkshape_shiftUp = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_ewkshape_shiftUp->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_anticorrelated_ewkshape_shiftUp");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_anticorrelated_ewkshape_shiftUp->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_anticorrelated_ewkshape_shiftDown = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_ewkshape_shiftDown->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_anticorrelated_ewkshape_shiftDown");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_anticorrelated_ewkshape_shiftDown->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_anticorrelated_gamma_shiftUp = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_gamma_shiftUp->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_anticorrelated_gamma_shiftUp");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_anticorrelated_gamma_shiftUp->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_anticorrelated_gamma_shiftDown = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_anticorrelated_gamma_shiftDown->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_anticorrelated_gamma_shiftDown");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_anticorrelated_gamma_shiftDown->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_pdf_shiftUp = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_pdf_shiftUp->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_pdf_shiftUp");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_pdf_shiftUp->Write();
  TH1F* transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_pdf_shiftDown = (TH1F*)transfer_factor_WGinZnnG_to_ZnnGinZnnG_pdf_shiftDown->Clone("transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_pdf_shiftDown");
  transfer_factor_WGinZnnG_to_ZnnGinZnnG_above0p5_pdf_shiftDown->Write();
  
  // WGinWenG_to_WGinZnnG
  TH1F* transfer_factor_WGinWenG_to_WGinZnnG_above0p5_noShift = (TH1F*)transfer_factor_WGinWenG_to_WGinZnnG_noShift->Clone("transfer_factor_WGinWenG_to_WGinZnnG_above0p5_noShift");
  transfer_factor_WGinWenG_to_WGinZnnG_above0p5_noShift->Scale(1.0-1.0/3.14159);
  transfer_factor_WGinWenG_to_WGinZnnG_above0p5_noShift->Write();
  TH1F* transfer_factor_WGinWenG_to_WGinZnnG_above0p5_eleEff_shiftUp = (TH1F*)transfer_factor_WGinWenG_to_WGinZnnG_eleEff_shiftUp->Clone("transfer_factor_WGinWenG_to_WGinZnnG_above0p5_eleEff_shiftUp");
  transfer_factor_WGinWenG_to_WGinZnnG_above0p5_eleEff_shiftUp->Scale(1.0-1.0/3.14159);
  transfer_factor_WGinWenG_to_WGinZnnG_above0p5_eleEff_shiftUp->Write();
  TH1F* transfer_factor_WGinWenG_to_WGinZnnG_above0p5_eleEff_shiftDown = (TH1F*)transfer_factor_WGinWenG_to_WGinZnnG_eleEff_shiftDown->Clone("transfer_factor_WGinWenG_to_WGinZnnG_above0p5_eleEff_shiftDown");
  transfer_factor_WGinWenG_to_WGinZnnG_above0p5_eleEff_shiftDown->Scale(1.0-1.0/3.14159);
  transfer_factor_WGinWenG_to_WGinZnnG_above0p5_eleEff_shiftDown->Write();
  
  // WGinWmnG_to_WGinZnnG
  TH1F* transfer_factor_WGinWmnG_to_WGinZnnG_above0p5_noShift = (TH1F*)transfer_factor_WGinWmnG_to_WGinZnnG_noShift->Clone("transfer_factor_WGinWmnG_to_WGinZnnG_above0p5_noShift");
  transfer_factor_WGinWmnG_to_WGinZnnG_above0p5_noShift->Scale(1.0-1.0/3.14159);
  transfer_factor_WGinWmnG_to_WGinZnnG_above0p5_noShift->Write();
  TH1F* transfer_factor_WGinWmnG_to_WGinZnnG_above0p5_muEff_shiftUp = (TH1F*)transfer_factor_WGinWmnG_to_WGinZnnG_muEff_shiftUp->Clone("transfer_factor_WGinWmnG_to_WGinZnnG_above0p5_muEff_shiftUp");
  transfer_factor_WGinWmnG_to_WGinZnnG_above0p5_muEff_shiftUp->Scale(1.0-1.0/3.14159);
  transfer_factor_WGinWmnG_to_WGinZnnG_above0p5_muEff_shiftUp->Write();
  TH1F* transfer_factor_WGinWmnG_to_WGinZnnG_above0p5_muEff_shiftDown = (TH1F*)transfer_factor_WGinWmnG_to_WGinZnnG_muEff_shiftDown->Clone("transfer_factor_WGinWmnG_to_WGinZnnG_above0p5_muEff_shiftDown");
  transfer_factor_WGinWmnG_to_WGinZnnG_above0p5_muEff_shiftDown->Scale(1.0-1.0/3.14159);
  transfer_factor_WGinWmnG_to_WGinZnnG_above0p5_muEff_shiftDown->Write();
  
  // ZllGinZeeG_to_ZnnGinZnnG
  TH1F* transfer_factor_ZllGinZeeG_to_ZnnGinZnnG_above0p5_noShift = (TH1F*)transfer_factor_ZllGinZeeG_to_ZnnGinZnnG_noShift->Clone("transfer_factor_ZllGinZeeG_to_ZnnGinZnnG_above0p5_noShift");
  transfer_factor_ZllGinZeeG_to_ZnnGinZnnG_above0p5_noShift->Scale(1.0-1.0/3.14159);
  transfer_factor_ZllGinZeeG_to_ZnnGinZnnG_above0p5_noShift->Write();
  TH1F* transfer_factor_ZllGinZeeG_to_ZnnGinZnnG_above0p5_eleEff_shiftUp = (TH1F*)transfer_factor_ZllGinZeeG_to_ZnnGinZnnG_eleEff_shiftUp->Clone("transfer_factor_ZllGinZeeG_to_ZnnGinZnnG_above0p5_eleEff_shiftUp");
  transfer_factor_ZllGinZeeG_to_ZnnGinZnnG_above0p5_eleEff_shiftUp->Scale(1.0-1.0/3.14159);
  transfer_factor_ZllGinZeeG_to_ZnnGinZnnG_above0p5_eleEff_shiftUp->Write();
  TH1F* transfer_factor_ZllGinZeeG_to_ZnnGinZnnG_above0p5_eleEff_shiftDown = (TH1F*)transfer_factor_ZllGinZeeG_to_ZnnGinZnnG_eleEff_shiftDown->Clone("transfer_factor_ZllGinZeeG_to_ZnnGinZnnG_above0p5_eleEff_shiftDown");
  transfer_factor_ZllGinZeeG_to_ZnnGinZnnG_above0p5_eleEff_shiftDown->Scale(1.0-1.0/3.14159);
  transfer_factor_ZllGinZeeG_to_ZnnGinZnnG_above0p5_eleEff_shiftDown->Write();
  
  // ZllGinZmmG_to_ZnnGinZnnG
  TH1F* transfer_factor_ZllGinZmmG_to_ZnnGinZnnG_above0p5_noShift = (TH1F*)transfer_factor_ZllGinZmmG_to_ZnnGinZnnG_noShift->Clone("transfer_factor_ZllGinZmmG_to_ZnnGinZnnG_above0p5_noShift");
  transfer_factor_ZllGinZmmG_to_ZnnGinZnnG_above0p5_noShift->Scale(1.0-1.0/3.14159);
  transfer_factor_ZllGinZmmG_to_ZnnGinZnnG_above0p5_noShift->Write();
  TH1F* transfer_factor_ZllGinZmmG_to_ZnnGinZnnG_above0p5_muEff_shiftUp = (TH1F*)transfer_factor_ZllGinZmmG_to_ZnnGinZnnG_muEff_shiftUp->Clone("transfer_factor_ZllGinZmmG_to_ZnnGinZnnG_above0p5_muEff_shiftUp");
  transfer_factor_ZllGinZmmG_to_ZnnGinZnnG_above0p5_muEff_shiftUp->Scale(1.0-1.0/3.14159);
  transfer_factor_ZllGinZmmG_to_ZnnGinZnnG_above0p5_muEff_shiftUp->Write();
  TH1F* transfer_factor_ZllGinZmmG_to_ZnnGinZnnG_above0p5_muEff_shiftDown = (TH1F*)transfer_factor_ZllGinZmmG_to_ZnnGinZnnG_muEff_shiftDown->Clone("transfer_factor_ZllGinZmmG_to_ZnnGinZnnG_above0p5_muEff_shiftDown");
  transfer_factor_ZllGinZmmG_to_ZnnGinZnnG_above0p5_muEff_shiftDown->Scale(1.0-1.0/3.14159);
  transfer_factor_ZllGinZmmG_to_ZnnGinZnnG_above0p5_muEff_shiftDown->Write();
  
  // SBtoSA
  transfer_factor_SBtoSA->Write();
  transfer_factor_SBtoSA_halo->Write();
  
  rootfile->Close();
}

void transfer_histo_collator()
{
    //DEBUG
  cout<<"-----------------------"<<endl;
  cout<<"Pt"<<endl;
  collate_transfer_histos_singlevariable("Pt");
  //DEBUG
  cout<<"-----------------------"<<endl;
  cout<<"MET"<<endl;
  collate_transfer_histos_singlevariable("MET");
  //DEBUG
  cout<<"-----------------------"<<endl;
  cout<<"Mt"<<endl;
  collate_transfer_histos_singlevariable("Mt");
}